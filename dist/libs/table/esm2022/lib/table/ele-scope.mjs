import { GeoData } from "./data/geo-data";
export class EleScope {
    hostElement;
    tableModel;
    dom;
    tableOptions;
    scrollViewport;
    contentWrapperDiv; // the big one. height: sum of rows height == tableModel.getContentHeightInPixel()
    contentDiv;
    areaHeaderCenter;
    areaHeaderWest;
    areaHeaderEast;
    areaBodyCenter;
    areaBodyWest;
    areaBodyEast;
    areaFooterCenter;
    areaFooterWest;
    areaFooterEast;
    borderHeaderBottom;
    borderFooterTop;
    borderFixedWest;
    borderFixedEast;
    hoverRow;
    hoverColumn;
    scrollTop = 0;
    areaBodyWestGeo = new GeoData();
    areaBodyCenterGeo = new GeoData();
    areaBodyEastGeo = new GeoData();
    constructor(hostElement, tableModel, dom, tableOptions) {
        this.hostElement = hostElement;
        this.tableModel = tableModel;
        this.dom = dom;
        this.tableOptions = tableOptions;
        const hostEle = this.hostElement;
        hostEle.innerText = ""; // clear
        this.dom.setAttribute(hostEle, "tabindex", "0"); // needed for getting key events
        this.dom.setStyle(this.dom.addClass("ge-table", hostEle), "position", "relative");
        this.hoverRow =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-hover-row", hostEle));
        this.hoverColumn =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-hover-column", hostEle));
        this.areaHeaderWest = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-header ge-table-header-west", hostEle, "header", "west")));
        this.areaHeaderCenter = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-header ge-table-header-center", hostEle, "header", "center")));
        this.areaHeaderEast = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-header ge-table-header-east", hostEle, "body", "east")));
        this.areaBodyWest = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-body ge-table-body-west", hostEle, "body", "west")));
        this.areaBodyEast = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-body ge-table-body-east", hostEle, "body", "east")));
        this.areaFooterWest = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-footer ge-table-footer-west", hostEle, "footer", "west")));
        this.areaFooterCenter = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-footer ge-table-footer-center", hostEle, "footer", "center")));
        this.areaFooterEast = dom.appendRelativeChildDiv(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-footer ge-table-footer-east", hostEle, "footer", "east")));
        this.scrollViewport =
            dom.applyStyleOverflowAuto(this.tableOptions.overflowX ?? "auto", this.tableOptions.overflowY ?? "auto", dom.applyStyleNoPadding(dom.applyStylePosistionAbsolute(dom.createAreaDivWithClass("ge-table-scroll-viewport", hostEle, "body", "center"))));
        this.contentWrapperDiv = dom.applyStyleNoPadding(dom.applyStylePosistionRelative(dom.createDivWithClass("ge-table-scroll-content-wrapper", this.scrollViewport)));
        this.contentDiv = dom.applyStyleNoPadding(dom.applyStylePosistionRelative(dom.createDivWithClass("ge-table-scroll-content", this.contentWrapperDiv)));
        this.areaBodyCenter = dom.appendRelativeChildDiv(dom.createDivWithClass("ge-table-body-center", this.contentDiv));
        this.borderHeaderBottom =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-header-border", hostEle));
        this.borderFixedWest =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-west-fixed-column-border", hostEle));
        this.borderFixedEast =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-east-fixed-column-border", hostEle));
        this.borderFooterTop =
            dom.applyStylePosistionAbsolute(dom.createDivWithClass("ge-table-footer-border", hostEle));
    }
    adjustContainersAndRows() {
        const padding = this.tableModel.getPadding();
        const w = this.hostElement.clientWidth;
        const h = this.hostElement.clientHeight;
        this.dom.applyStyle(this.scrollViewport, {
            width: `${(w - padding.left)}px`,
            height: `${(h - padding.top)}px`,
            top: `${padding.top}px`,
            left: `${padding.left}px`
        });
        this.scrollTop = this.scrollViewport.scrollTop;
        // Content:
        this.dom.applyStyle(this.contentDiv, {
            width: `${this.scrollViewport.clientWidth}px`,
            height: `${this.scrollViewport.clientHeight}px`,
            top: `${this.scrollTop}px`,
            left: `${this.scrollViewport.scrollLeft}px`
        });
        // Body:
        // Body/West:
        this.areaBodyWestGeo.width = padding.left;
        this.areaBodyWestGeo.height = (h - padding.top - padding.bottom);
        this.areaBodyWestGeo.top = padding.top;
        this.areaBodyWestGeo.left = 0;
        this.dom.applyStyleInPx(this.areaBodyWest.parent, this.areaBodyWestGeo);
        if (this.tableOptions.fixedWestSeparatorBorderVisible &&
            this.tableModel.getFixedLeftColumnCount()) {
            this.dom.applyDisplayBlockStyle(this.dom.applyStyle(this.borderFixedWest, {
                width: `1px`,
                height: `${this.areaBodyWestGeo.height}px`,
                top: `${this.areaBodyWestGeo.top}px`,
                left: `${this.areaBodyWestGeo.width}px`
            }));
        }
        else {
            this.dom.applyDisplayNoneStyle(this.borderFixedWest);
        }
        // Body/East:
        this.areaBodyEastGeo.width = padding.right;
        this.areaBodyEastGeo.height = (h - padding.top - padding.bottom);
        this.areaBodyEastGeo.top = padding.top;
        this.areaBodyEastGeo.left = w - padding.right;
        this.dom.applyStyleInPx(this.areaBodyEast.parent, this.areaBodyEastGeo);
        if (this.tableOptions.fixedEastSeparatorBorderVisible &&
            this.tableModel.getFixedLeftColumnCount()) {
            this.dom.applyDisplayBlockStyle(this.dom.applyStyle(this.borderFixedEast, {
                width: `1px`,
                height: `${this.areaBodyEastGeo.height}px`,
                top: `${this.areaBodyEastGeo.top}px`,
                left: `${this.areaBodyEastGeo.left}px`
            }));
        }
        else {
            this.dom.applyDisplayNoneStyle(this.borderFixedEast);
        }
        // Body/Center:
        this.areaBodyCenterGeo.width = (w - padding.left - padding.right);
        this.areaBodyCenterGeo.height = (h - padding.top - padding.bottom);
        this.areaBodyCenterGeo.top = 0;
        this.areaBodyCenterGeo.left = 0;
        this.dom.applyStyleInPx(this.areaBodyCenter.parent, this.areaBodyCenterGeo);
        // Header:
        this.dom.applyStyle(this.areaHeaderCenter.parent, {
            width: `${w - padding.left - padding.right}px`,
            height: `${padding.top}px`,
            top: "0",
            left: `${padding.left}px`
        });
        this.dom.applyStyle(this.areaHeaderWest.parent, {
            width: `${padding.left}px`,
            height: `${padding.top}px`,
            top: "0",
            left: "0"
        });
        this.dom.applyStyle(this.areaHeaderEast.parent, {
            width: `${padding.right}px`,
            height: `${padding.top}px`,
            top: "0",
            left: `${w - padding.right}px`
        });
        if (this.tableOptions.headerSeparatorBorderVisible &&
            this.tableModel.isHeaderVisibe()) {
            this.dom.applyDisplayBlockStyle(this.dom.applyStyle(this.borderHeaderBottom, {
                width: `${w}px`,
                height: "1px",
                top: `${padding.top}px`,
                left: "0px"
            }));
        }
        else {
            this.dom.applyDisplayNoneStyle(this.borderHeaderBottom);
        }
        // Footer:
        this.dom.applyStyle(this.areaFooterWest.parent, {
            width: `${padding.left}px`,
            height: `${padding.bottom}px`,
            top: `${h - padding.bottom}px`,
            left: "0"
        });
        this.dom.applyStyle(this.areaFooterCenter.parent, {
            width: `${w - padding.left - padding.right}px`,
            height: `${padding.bottom}px`,
            top: `${h - padding.bottom}px`,
            left: `${padding.left}px`
        });
        this.dom.applyStyle(this.areaFooterEast.parent, {
            width: `${padding.right}px`,
            height: `${padding.bottom}px`,
            top: `${h - padding.bottom}px`,
            left: `${w - padding.right}px`
        });
        if (this.tableOptions.footerSeparatorBorderVisible &&
            this.tableModel.isFooterVisibe()) {
            this.dom.applyDisplayBlockStyle(this.dom.applyStyle(this.borderFooterTop, {
                width: `${w}px`,
                height: "1px",
                top: `${h - padding.bottom}px`,
                left: "0px"
            }));
        }
        else {
            this.dom.applyDisplayNoneStyle(this.borderFooterTop);
        }
        this.adjustAfterScrolling();
    }
    adjustAfterScrolling() {
        // must be overwritten
    }
    resetSizeOfWrapperDiv() {
        const w = `${this.tableModel.getContentWidthInPixel()}px`;
        const h = `${this.tableModel.getContentHeightInPixel() + 1}px`; // + 1, we want to see the last horizontal border
        this.dom.setStyle(this.contentWrapperDiv, "width", w);
        this.dom.setStyle(this.contentWrapperDiv, "height", h);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlLXNjb3BlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy90YWJsZS9zcmMvbGliL3RhYmxlL2VsZS1zY29wZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHMUMsTUFBTSxPQUFPLFFBQVE7SUFvQ1I7SUFDQTtJQUNVO0lBQ1Y7SUFyQ0osY0FBYyxDQUFpQjtJQUU1QixpQkFBaUIsQ0FBaUIsQ0FBQyxrRkFBa0Y7SUFDckgsVUFBVSxDQUFpQjtJQUUzQixnQkFBZ0IsQ0FBVztJQUMzQixjQUFjLENBQVc7SUFDekIsY0FBYyxDQUFXO0lBRXpCLGNBQWMsQ0FBVztJQUN6QixZQUFZLENBQVc7SUFDdkIsWUFBWSxDQUFXO0lBR3ZCLGdCQUFnQixDQUFXO0lBQzNCLGNBQWMsQ0FBVztJQUN6QixjQUFjLENBQVc7SUFFekIsa0JBQWtCLENBQWlCO0lBQ25DLGVBQWUsQ0FBaUI7SUFDaEMsZUFBZSxDQUFpQjtJQUNoQyxlQUFlLENBQWlCO0lBRWhDLFFBQVEsQ0FBaUI7SUFDekIsV0FBVyxDQUFpQjtJQUU1QixTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBRWQsZUFBZSxHQUFZLElBQUksT0FBTyxFQUFFLENBQUM7SUFDekMsaUJBQWlCLEdBQVksSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUMzQyxlQUFlLEdBQVksSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUduRCxZQUNXLFdBQTJCLEVBQzNCLFVBQXdCLEVBQ2QsR0FBMEIsRUFDcEMsWUFBNEI7UUFINUIsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQzNCLGVBQVUsR0FBVixVQUFVLENBQWM7UUFDZCxRQUFHLEdBQUgsR0FBRyxDQUF1QjtRQUNwQyxpQkFBWSxHQUFaLFlBQVksQ0FBZ0I7UUFFckMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUVqQyxPQUFPLENBQUMsU0FB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SSxDQUFDLGlCQUFpQixFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7Q0FFRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnZlbmllbmNlRG9tU2VydmljZSB9IGZyb20gXCIuL3NlcnZpY2UvY29udmVuaWVuY2UtZG9tLnNlcnZpY2VcIjtcbmltcG9ydCB7IERpdlNjb3BlIH0gZnJvbSBcIi4vZGF0YS9kaXYtc2NvcGUudHlwZVwiO1xuaW1wb3J0IHsgVGFibGVNb2RlbElmIH0gZnJvbSBcIi4vZGF0YS90YWJsZW1vZGVsL3RhYmxlLW1vZGVsLmlmXCI7XG5pbXBvcnQgeyBUYWJsZU9wdGlvbnNJZiB9IGZyb20gXCIuL2RhdGEvb3B0aW9ucy90YWJsZS1vcHRpb25zLmlmXCI7XG5pbXBvcnQgeyBHZW9EYXRhIH0gZnJvbSBcIi4vZGF0YS9nZW8tZGF0YVwiO1xuXG5cbmV4cG9ydCBjbGFzcyBFbGVTY29wZSB7XG5cbiAgcHVibGljIHNjcm9sbFZpZXdwb3J0OiBIVE1MRGl2RWxlbWVudDtcblxuICBwcm90ZWN0ZWQgY29udGVudFdyYXBwZXJEaXY6IEhUTUxEaXZFbGVtZW50OyAvLyB0aGUgYmlnIG9uZS4gaGVpZ2h0OiBzdW0gb2Ygcm93cyBoZWlnaHQgPT0gdGFibGVNb2RlbC5nZXRDb250ZW50SGVpZ2h0SW5QaXhlbCgpXG4gIHByb3RlY3RlZCBjb250ZW50RGl2OiBIVE1MRGl2RWxlbWVudDtcblxuICBwcm90ZWN0ZWQgYXJlYUhlYWRlckNlbnRlcjogRGl2U2NvcGU7XG4gIHByb3RlY3RlZCBhcmVhSGVhZGVyV2VzdDogRGl2U2NvcGU7XG4gIHByb3RlY3RlZCBhcmVhSGVhZGVyRWFzdDogRGl2U2NvcGU7XG5cbiAgcHJvdGVjdGVkIGFyZWFCb2R5Q2VudGVyOiBEaXZTY29wZTtcbiAgcHJvdGVjdGVkIGFyZWFCb2R5V2VzdDogRGl2U2NvcGU7XG4gIHByb3RlY3RlZCBhcmVhQm9keUVhc3Q6IERpdlNjb3BlO1xuXG5cbiAgcHJvdGVjdGVkIGFyZWFGb290ZXJDZW50ZXI6IERpdlNjb3BlO1xuICBwcm90ZWN0ZWQgYXJlYUZvb3Rlcldlc3Q6IERpdlNjb3BlO1xuICBwcm90ZWN0ZWQgYXJlYUZvb3RlckVhc3Q6IERpdlNjb3BlO1xuXG4gIHByb3RlY3RlZCBib3JkZXJIZWFkZXJCb3R0b206IEhUTUxEaXZFbGVtZW50O1xuICBwcm90ZWN0ZWQgYm9yZGVyRm9vdGVyVG9wOiBIVE1MRGl2RWxlbWVudDtcbiAgcHJvdGVjdGVkIGJvcmRlckZpeGVkV2VzdDogSFRNTERpdkVsZW1lbnQ7XG4gIHByb3RlY3RlZCBib3JkZXJGaXhlZEVhc3Q6IEhUTUxEaXZFbGVtZW50O1xuXG4gIHByb3RlY3RlZCBob3ZlclJvdzogSFRNTERpdkVsZW1lbnQ7XG4gIHByb3RlY3RlZCBob3ZlckNvbHVtbjogSFRNTERpdkVsZW1lbnQ7XG5cbiAgcHJvdGVjdGVkIHNjcm9sbFRvcCA9IDA7XG5cbiAgcHJvdGVjdGVkIGFyZWFCb2R5V2VzdEdlbzogR2VvRGF0YSA9IG5ldyBHZW9EYXRhKCk7XG4gIHByb3RlY3RlZCBhcmVhQm9keUNlbnRlckdlbzogR2VvRGF0YSA9IG5ldyBHZW9EYXRhKCk7XG4gIHByb3RlY3RlZCBhcmVhQm9keUVhc3RHZW86IEdlb0RhdGEgPSBuZXcgR2VvRGF0YSgpO1xuXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcmVhZG9ubHkgaG9zdEVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50LFxuICAgIHJlYWRvbmx5IHRhYmxlTW9kZWw6IFRhYmxlTW9kZWxJZixcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgZG9tOiBDb252ZW5pZW5jZURvbVNlcnZpY2UsXG4gICAgcmVhZG9ubHkgdGFibGVPcHRpb25zOiBUYWJsZU9wdGlvbnNJZlxuICApIHtcbiAgICBjb25zdCBob3N0RWxlID0gdGhpcy5ob3N0RWxlbWVudDtcblxuICAgIGhvc3RFbGUuaW5uZXJUZXh0ID0gXCJcIjsgLy8gY2xlYXJcbiAgICB0aGlzLmRvbS5zZXRBdHRyaWJ1dGUoaG9zdEVsZSwgXCJ0YWJpbmRleFwiLCBcIjBcIik7IC8vIG5lZWRlZCBmb3IgZ2V0dGluZyBrZXkgZXZlbnRzXG5cbiAgICB0aGlzLmRvbS5zZXRTdHlsZShcbiAgICAgIHRoaXMuZG9tLmFkZENsYXNzKFwiZ2UtdGFibGVcIiwgaG9zdEVsZSlcbiAgICAgICwgXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xuXG5cbiAgICB0aGlzLmhvdmVyUm93ID1cbiAgICAgIGRvbS5hcHBseVN0eWxlUG9zaXN0aW9uQWJzb2x1dGUoXG4gICAgICAgIGRvbS5jcmVhdGVEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1ob3Zlci1yb3dcIiwgaG9zdEVsZSkpO1xuICAgIHRoaXMuaG92ZXJDb2x1bW4gPVxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZURpdldpdGhDbGFzcyhcImdlLXRhYmxlLWhvdmVyLWNvbHVtblwiLCBob3N0RWxlKSk7XG5cbiAgICB0aGlzLmFyZWFIZWFkZXJXZXN0ID0gZG9tLmFwcGVuZFJlbGF0aXZlQ2hpbGREaXYoXG4gICAgICBkb20uYXBwbHlTdHlsZVBvc2lzdGlvbkFic29sdXRlKFxuICAgICAgICBkb20uY3JlYXRlQXJlYURpdldpdGhDbGFzcyhcImdlLXRhYmxlLWhlYWRlciBnZS10YWJsZS1oZWFkZXItd2VzdFwiLCBob3N0RWxlLCBcImhlYWRlclwiLCBcIndlc3RcIikpKTtcbiAgICB0aGlzLmFyZWFIZWFkZXJDZW50ZXIgPSBkb20uYXBwZW5kUmVsYXRpdmVDaGlsZERpdihcbiAgICAgIGRvbS5hcHBseVN0eWxlUG9zaXN0aW9uQWJzb2x1dGUoXG4gICAgICAgIGRvbS5jcmVhdGVBcmVhRGl2V2l0aENsYXNzKFwiZ2UtdGFibGUtaGVhZGVyIGdlLXRhYmxlLWhlYWRlci1jZW50ZXJcIiwgaG9zdEVsZSwgXCJoZWFkZXJcIiwgXCJjZW50ZXJcIikpKTtcbiAgICB0aGlzLmFyZWFIZWFkZXJFYXN0ID0gZG9tLmFwcGVuZFJlbGF0aXZlQ2hpbGREaXYoXG4gICAgICBkb20uYXBwbHlTdHlsZVBvc2lzdGlvbkFic29sdXRlKFxuICAgICAgICBkb20uY3JlYXRlQXJlYURpdldpdGhDbGFzcyhcImdlLXRhYmxlLWhlYWRlciBnZS10YWJsZS1oZWFkZXItZWFzdFwiLCBob3N0RWxlLCBcImJvZHlcIiwgXCJlYXN0XCIpKSk7XG5cbiAgICB0aGlzLmFyZWFCb2R5V2VzdCA9IGRvbS5hcHBlbmRSZWxhdGl2ZUNoaWxkRGl2KFxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZUFyZWFEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1ib2R5IGdlLXRhYmxlLWJvZHktd2VzdFwiLCBob3N0RWxlLCBcImJvZHlcIiwgXCJ3ZXN0XCIpKSk7XG5cbiAgICB0aGlzLmFyZWFCb2R5RWFzdCA9IGRvbS5hcHBlbmRSZWxhdGl2ZUNoaWxkRGl2KFxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZUFyZWFEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1ib2R5IGdlLXRhYmxlLWJvZHktZWFzdFwiLCBob3N0RWxlLCBcImJvZHlcIiwgXCJlYXN0XCIpKSk7XG5cbiAgICB0aGlzLmFyZWFGb290ZXJXZXN0ID0gZG9tLmFwcGVuZFJlbGF0aXZlQ2hpbGREaXYoXG4gICAgICBkb20uYXBwbHlTdHlsZVBvc2lzdGlvbkFic29sdXRlKFxuICAgICAgICBkb20uY3JlYXRlQXJlYURpdldpdGhDbGFzcyhcImdlLXRhYmxlLWZvb3RlciBnZS10YWJsZS1mb290ZXItd2VzdFwiLCBob3N0RWxlLCBcImZvb3RlclwiLCBcIndlc3RcIikpKTtcblxuICAgIHRoaXMuYXJlYUZvb3RlckNlbnRlciA9IGRvbS5hcHBlbmRSZWxhdGl2ZUNoaWxkRGl2KFxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZUFyZWFEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1mb290ZXIgZ2UtdGFibGUtZm9vdGVyLWNlbnRlclwiLCBob3N0RWxlLCBcImZvb3RlclwiLCBcImNlbnRlclwiKSkpO1xuXG4gICAgdGhpcy5hcmVhRm9vdGVyRWFzdCA9IGRvbS5hcHBlbmRSZWxhdGl2ZUNoaWxkRGl2KFxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZUFyZWFEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1mb290ZXIgZ2UtdGFibGUtZm9vdGVyLWVhc3RcIiwgaG9zdEVsZSwgXCJmb290ZXJcIiwgXCJlYXN0XCIpKSk7XG5cbiAgICB0aGlzLnNjcm9sbFZpZXdwb3J0ID1cbiAgICAgIGRvbS5hcHBseVN0eWxlT3ZlcmZsb3dBdXRvKFxuICAgICAgICB0aGlzLnRhYmxlT3B0aW9ucy5vdmVyZmxvd1ggPz8gXCJhdXRvXCIsXG4gICAgICAgIHRoaXMudGFibGVPcHRpb25zLm92ZXJmbG93WSA/PyBcImF1dG9cIixcbiAgICAgICAgZG9tLmFwcGx5U3R5bGVOb1BhZGRpbmcoXG4gICAgICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgICAgIGRvbS5jcmVhdGVBcmVhRGl2V2l0aENsYXNzKFwiZ2UtdGFibGUtc2Nyb2xsLXZpZXdwb3J0XCIsIGhvc3RFbGUsIFwiYm9keVwiLCBcImNlbnRlclwiKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgIHRoaXMuY29udGVudFdyYXBwZXJEaXYgPSBkb20uYXBwbHlTdHlsZU5vUGFkZGluZyhcbiAgICAgIGRvbS5hcHBseVN0eWxlUG9zaXN0aW9uUmVsYXRpdmUoXG4gICAgICAgIGRvbS5jcmVhdGVEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1zY3JvbGwtY29udGVudC13cmFwcGVyXCIsIHRoaXMuc2Nyb2xsVmlld3BvcnQpKSk7XG4gICAgdGhpcy5jb250ZW50RGl2ID0gZG9tLmFwcGx5U3R5bGVOb1BhZGRpbmcoXG4gICAgICBkb20uYXBwbHlTdHlsZVBvc2lzdGlvblJlbGF0aXZlKFxuICAgICAgICBkb20uY3JlYXRlRGl2V2l0aENsYXNzKFwiZ2UtdGFibGUtc2Nyb2xsLWNvbnRlbnRcIiwgdGhpcy5jb250ZW50V3JhcHBlckRpdikpKTtcblxuICAgIHRoaXMuYXJlYUJvZHlDZW50ZXIgPSBkb20uYXBwZW5kUmVsYXRpdmVDaGlsZERpdihcbiAgICAgIGRvbS5jcmVhdGVEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1ib2R5LWNlbnRlclwiLCB0aGlzLmNvbnRlbnREaXYpKTtcblxuICAgIHRoaXMuYm9yZGVySGVhZGVyQm90dG9tID1cbiAgICAgIGRvbS5hcHBseVN0eWxlUG9zaXN0aW9uQWJzb2x1dGUoXG4gICAgICAgIGRvbS5jcmVhdGVEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS1oZWFkZXItYm9yZGVyXCIsIGhvc3RFbGUpKTtcblxuICAgIHRoaXMuYm9yZGVyRml4ZWRXZXN0ID1cbiAgICAgIGRvbS5hcHBseVN0eWxlUG9zaXN0aW9uQWJzb2x1dGUoXG4gICAgICAgIGRvbS5jcmVhdGVEaXZXaXRoQ2xhc3MoXCJnZS10YWJsZS13ZXN0LWZpeGVkLWNvbHVtbi1ib3JkZXJcIiwgaG9zdEVsZSkpO1xuXG4gICAgdGhpcy5ib3JkZXJGaXhlZEVhc3QgPVxuICAgICAgZG9tLmFwcGx5U3R5bGVQb3Npc3Rpb25BYnNvbHV0ZShcbiAgICAgICAgZG9tLmNyZWF0ZURpdldpdGhDbGFzcyhcImdlLXRhYmxlLWVhc3QtZml4ZWQtY29sdW1uLWJvcmRlclwiLCBob3N0RWxlKSk7XG5cbiAgICB0aGlzLmJvcmRlckZvb3RlclRvcCA9XG4gICAgICBkb20uYXBwbHlTdHlsZVBvc2lzdGlvbkFic29sdXRlKFxuICAgICAgICBkb20uY3JlYXRlRGl2V2l0aENsYXNzKFwiZ2UtdGFibGUtZm9vdGVyLWJvcmRlclwiLCBob3N0RWxlKSk7XG4gIH1cblxuXG4gIGFkanVzdENvbnRhaW5lcnNBbmRSb3dzKCkge1xuICAgIGNvbnN0IHBhZGRpbmcgPSB0aGlzLnRhYmxlTW9kZWwuZ2V0UGFkZGluZygpO1xuICAgIGNvbnN0IHcgPSB0aGlzLmhvc3RFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgIGNvbnN0IGggPSB0aGlzLmhvc3RFbGVtZW50LmNsaWVudEhlaWdodDtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlKHRoaXMuc2Nyb2xsVmlld3BvcnQsIHtcbiAgICAgIHdpZHRoOiBgJHsodyAtIHBhZGRpbmcubGVmdCl9cHhgLFxuICAgICAgaGVpZ2h0OiBgJHsoaCAtIHBhZGRpbmcudG9wKX1weGAsXG4gICAgICB0b3A6IGAke3BhZGRpbmcudG9wfXB4YCxcbiAgICAgIGxlZnQ6IGAke3BhZGRpbmcubGVmdH1weGBcbiAgICB9KTtcblxuICAgIHRoaXMuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxWaWV3cG9ydC5zY3JvbGxUb3A7XG5cbiAgICAvLyBDb250ZW50OlxuICAgIHRoaXMuZG9tLmFwcGx5U3R5bGUodGhpcy5jb250ZW50RGl2LCB7XG4gICAgICB3aWR0aDogYCR7dGhpcy5zY3JvbGxWaWV3cG9ydC5jbGllbnRXaWR0aH1weGAsXG4gICAgICBoZWlnaHQ6IGAke3RoaXMuc2Nyb2xsVmlld3BvcnQuY2xpZW50SGVpZ2h0fXB4YCxcbiAgICAgIHRvcDogYCR7dGhpcy5zY3JvbGxUb3B9cHhgLFxuICAgICAgbGVmdDogYCR7dGhpcy5zY3JvbGxWaWV3cG9ydC5zY3JvbGxMZWZ0fXB4YFxuICAgIH0pO1xuXG4gICAgLy8gQm9keTpcbiAgICAvLyBCb2R5L1dlc3Q6XG4gICAgdGhpcy5hcmVhQm9keVdlc3RHZW8ud2lkdGggPSBwYWRkaW5nLmxlZnQ7XG4gICAgdGhpcy5hcmVhQm9keVdlc3RHZW8uaGVpZ2h0ID0gKGggLSBwYWRkaW5nLnRvcCAtIHBhZGRpbmcuYm90dG9tKTtcbiAgICB0aGlzLmFyZWFCb2R5V2VzdEdlby50b3AgPSBwYWRkaW5nLnRvcDtcbiAgICB0aGlzLmFyZWFCb2R5V2VzdEdlby5sZWZ0ID0gMDtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlSW5QeCh0aGlzLmFyZWFCb2R5V2VzdC5wYXJlbnQsIHRoaXMuYXJlYUJvZHlXZXN0R2VvKTtcbiAgICBpZiAodGhpcy50YWJsZU9wdGlvbnMuZml4ZWRXZXN0U2VwYXJhdG9yQm9yZGVyVmlzaWJsZSAmJlxuICAgICAgdGhpcy50YWJsZU1vZGVsLmdldEZpeGVkTGVmdENvbHVtbkNvdW50KCkpIHtcbiAgICAgIHRoaXMuZG9tLmFwcGx5RGlzcGxheUJsb2NrU3R5bGUoXG4gICAgICAgIHRoaXMuZG9tLmFwcGx5U3R5bGUodGhpcy5ib3JkZXJGaXhlZFdlc3QsIHtcbiAgICAgICAgICB3aWR0aDogYDFweGAsXG4gICAgICAgICAgaGVpZ2h0OiBgJHt0aGlzLmFyZWFCb2R5V2VzdEdlby5oZWlnaHR9cHhgLFxuICAgICAgICAgIHRvcDogYCR7dGhpcy5hcmVhQm9keVdlc3RHZW8udG9wfXB4YCxcbiAgICAgICAgICBsZWZ0OiBgJHt0aGlzLmFyZWFCb2R5V2VzdEdlby53aWR0aH1weGBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZG9tLmFwcGx5RGlzcGxheU5vbmVTdHlsZSh0aGlzLmJvcmRlckZpeGVkV2VzdCk7XG4gICAgfVxuXG4gICAgLy8gQm9keS9FYXN0OlxuICAgIHRoaXMuYXJlYUJvZHlFYXN0R2VvLndpZHRoID0gcGFkZGluZy5yaWdodDtcbiAgICB0aGlzLmFyZWFCb2R5RWFzdEdlby5oZWlnaHQgPSAoaCAtIHBhZGRpbmcudG9wIC0gcGFkZGluZy5ib3R0b20pO1xuICAgIHRoaXMuYXJlYUJvZHlFYXN0R2VvLnRvcCA9IHBhZGRpbmcudG9wO1xuICAgIHRoaXMuYXJlYUJvZHlFYXN0R2VvLmxlZnQgPSB3IC0gcGFkZGluZy5yaWdodDtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlSW5QeCh0aGlzLmFyZWFCb2R5RWFzdC5wYXJlbnQsIHRoaXMuYXJlYUJvZHlFYXN0R2VvKTtcblxuICAgIGlmICh0aGlzLnRhYmxlT3B0aW9ucy5maXhlZEVhc3RTZXBhcmF0b3JCb3JkZXJWaXNpYmxlICYmXG4gICAgICB0aGlzLnRhYmxlTW9kZWwuZ2V0Rml4ZWRMZWZ0Q29sdW1uQ291bnQoKSkge1xuICAgICAgdGhpcy5kb20uYXBwbHlEaXNwbGF5QmxvY2tTdHlsZShcbiAgICAgICAgdGhpcy5kb20uYXBwbHlTdHlsZSh0aGlzLmJvcmRlckZpeGVkRWFzdCwge1xuICAgICAgICAgIHdpZHRoOiBgMXB4YCxcbiAgICAgICAgICBoZWlnaHQ6IGAke3RoaXMuYXJlYUJvZHlFYXN0R2VvLmhlaWdodH1weGAsXG4gICAgICAgICAgdG9wOiBgJHt0aGlzLmFyZWFCb2R5RWFzdEdlby50b3B9cHhgLFxuICAgICAgICAgIGxlZnQ6IGAke3RoaXMuYXJlYUJvZHlFYXN0R2VvLmxlZnR9cHhgXG4gICAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kb20uYXBwbHlEaXNwbGF5Tm9uZVN0eWxlKHRoaXMuYm9yZGVyRml4ZWRFYXN0KTtcbiAgICB9XG5cbiAgICAvLyBCb2R5L0NlbnRlcjpcbiAgICB0aGlzLmFyZWFCb2R5Q2VudGVyR2VvLndpZHRoID0gKHcgLSBwYWRkaW5nLmxlZnQgLSBwYWRkaW5nLnJpZ2h0KTtcbiAgICB0aGlzLmFyZWFCb2R5Q2VudGVyR2VvLmhlaWdodCA9IChoIC0gcGFkZGluZy50b3AgLSBwYWRkaW5nLmJvdHRvbSk7XG4gICAgdGhpcy5hcmVhQm9keUNlbnRlckdlby50b3AgPSAwO1xuICAgIHRoaXMuYXJlYUJvZHlDZW50ZXJHZW8ubGVmdCA9IDA7XG4gICAgdGhpcy5kb20uYXBwbHlTdHlsZUluUHgodGhpcy5hcmVhQm9keUNlbnRlci5wYXJlbnQsIHRoaXMuYXJlYUJvZHlDZW50ZXJHZW8pO1xuXG5cbiAgICAvLyBIZWFkZXI6XG4gICAgdGhpcy5kb20uYXBwbHlTdHlsZSh0aGlzLmFyZWFIZWFkZXJDZW50ZXIucGFyZW50LCB7XG4gICAgICB3aWR0aDogYCR7dyAtIHBhZGRpbmcubGVmdCAtIHBhZGRpbmcucmlnaHR9cHhgLFxuICAgICAgaGVpZ2h0OiBgJHtwYWRkaW5nLnRvcH1weGAsXG4gICAgICB0b3A6IFwiMFwiLFxuICAgICAgbGVmdDogYCR7cGFkZGluZy5sZWZ0fXB4YFxuICAgIH0pO1xuICAgIHRoaXMuZG9tLmFwcGx5U3R5bGUodGhpcy5hcmVhSGVhZGVyV2VzdC5wYXJlbnQsIHtcbiAgICAgIHdpZHRoOiBgJHtwYWRkaW5nLmxlZnR9cHhgLFxuICAgICAgaGVpZ2h0OiBgJHtwYWRkaW5nLnRvcH1weGAsXG4gICAgICB0b3A6IFwiMFwiLFxuICAgICAgbGVmdDogXCIwXCJcbiAgICB9KTtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlKHRoaXMuYXJlYUhlYWRlckVhc3QucGFyZW50LCB7XG4gICAgICB3aWR0aDogYCR7cGFkZGluZy5yaWdodH1weGAsXG4gICAgICBoZWlnaHQ6IGAke3BhZGRpbmcudG9wfXB4YCxcbiAgICAgIHRvcDogXCIwXCIsXG4gICAgICBsZWZ0OiBgJHt3IC0gcGFkZGluZy5yaWdodH1weGBcbiAgICB9KTtcbiAgICBpZiAodGhpcy50YWJsZU9wdGlvbnMuaGVhZGVyU2VwYXJhdG9yQm9yZGVyVmlzaWJsZSAmJlxuICAgICAgdGhpcy50YWJsZU1vZGVsLmlzSGVhZGVyVmlzaWJlKCkpIHtcbiAgICAgIHRoaXMuZG9tLmFwcGx5RGlzcGxheUJsb2NrU3R5bGUoXG4gICAgICAgIHRoaXMuZG9tLmFwcGx5U3R5bGUodGhpcy5ib3JkZXJIZWFkZXJCb3R0b20sIHtcbiAgICAgICAgICB3aWR0aDogYCR7d31weGAsXG4gICAgICAgICAgaGVpZ2h0OiBcIjFweFwiLFxuICAgICAgICAgIHRvcDogYCR7cGFkZGluZy50b3B9cHhgLFxuICAgICAgICAgIGxlZnQ6IFwiMHB4XCJcbiAgICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRvbS5hcHBseURpc3BsYXlOb25lU3R5bGUodGhpcy5ib3JkZXJIZWFkZXJCb3R0b20pO1xuICAgIH1cblxuICAgIC8vIEZvb3RlcjpcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlKHRoaXMuYXJlYUZvb3Rlcldlc3QucGFyZW50LCB7XG4gICAgICB3aWR0aDogYCR7cGFkZGluZy5sZWZ0fXB4YCxcbiAgICAgIGhlaWdodDogYCR7cGFkZGluZy5ib3R0b219cHhgLFxuICAgICAgdG9wOiBgJHtoIC0gcGFkZGluZy5ib3R0b219cHhgLFxuICAgICAgbGVmdDogXCIwXCJcbiAgICB9KTtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlKHRoaXMuYXJlYUZvb3RlckNlbnRlci5wYXJlbnQsIHtcbiAgICAgIHdpZHRoOiBgJHt3IC0gcGFkZGluZy5sZWZ0IC0gcGFkZGluZy5yaWdodH1weGAsXG4gICAgICBoZWlnaHQ6IGAke3BhZGRpbmcuYm90dG9tfXB4YCxcbiAgICAgIHRvcDogYCR7aCAtIHBhZGRpbmcuYm90dG9tfXB4YCxcbiAgICAgIGxlZnQ6IGAke3BhZGRpbmcubGVmdH1weGBcbiAgICB9KTtcbiAgICB0aGlzLmRvbS5hcHBseVN0eWxlKHRoaXMuYXJlYUZvb3RlckVhc3QucGFyZW50LCB7XG4gICAgICB3aWR0aDogYCR7cGFkZGluZy5yaWdodH1weGAsXG4gICAgICBoZWlnaHQ6IGAke3BhZGRpbmcuYm90dG9tfXB4YCxcbiAgICAgIHRvcDogYCR7aCAtIHBhZGRpbmcuYm90dG9tfXB4YCxcbiAgICAgIGxlZnQ6IGAke3cgLSBwYWRkaW5nLnJpZ2h0fXB4YFxuICAgIH0pO1xuICAgIGlmICh0aGlzLnRhYmxlT3B0aW9ucy5mb290ZXJTZXBhcmF0b3JCb3JkZXJWaXNpYmxlICYmXG4gICAgICB0aGlzLnRhYmxlTW9kZWwuaXNGb290ZXJWaXNpYmUoKSkge1xuICAgICAgdGhpcy5kb20uYXBwbHlEaXNwbGF5QmxvY2tTdHlsZShcbiAgICAgICAgdGhpcy5kb20uYXBwbHlTdHlsZSh0aGlzLmJvcmRlckZvb3RlclRvcCwge1xuICAgICAgICAgIHdpZHRoOiBgJHt3fXB4YCxcbiAgICAgICAgICBoZWlnaHQ6IFwiMXB4XCIsXG4gICAgICAgICAgdG9wOiBgJHtoIC0gcGFkZGluZy5ib3R0b219cHhgLFxuICAgICAgICAgIGxlZnQ6IFwiMHB4XCJcbiAgICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRvbS5hcHBseURpc3BsYXlOb25lU3R5bGUodGhpcy5ib3JkZXJGb290ZXJUb3ApO1xuICAgIH1cblxuICAgIHRoaXMuYWRqdXN0QWZ0ZXJTY3JvbGxpbmcoKTtcbiAgfVxuXG4gIGFkanVzdEFmdGVyU2Nyb2xsaW5nKCkge1xuICAgIC8vIG11c3QgYmUgb3ZlcndyaXR0ZW5cbiAgfVxuXG4gIHByb3RlY3RlZCByZXNldFNpemVPZldyYXBwZXJEaXYoKSB7XG4gICAgY29uc3QgdyA9IGAke3RoaXMudGFibGVNb2RlbC5nZXRDb250ZW50V2lkdGhJblBpeGVsKCl9cHhgO1xuICAgIGNvbnN0IGggPSBgJHt0aGlzLnRhYmxlTW9kZWwuZ2V0Q29udGVudEhlaWdodEluUGl4ZWwoKSArIDF9cHhgOyAvLyArIDEsIHdlIHdhbnQgdG8gc2VlIHRoZSBsYXN0IGhvcml6b250YWwgYm9yZGVyXG4gICAgdGhpcy5kb20uc2V0U3R5bGUodGhpcy5jb250ZW50V3JhcHBlckRpdiwgXCJ3aWR0aFwiLCB3KTtcbiAgICB0aGlzLmRvbS5zZXRTdHlsZSh0aGlzLmNvbnRlbnRXcmFwcGVyRGl2LCBcImhlaWdodFwiLCBoKTtcbiAgfVxuXG59XG4iXX0=