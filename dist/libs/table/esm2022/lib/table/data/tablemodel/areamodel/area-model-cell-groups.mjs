import { CellgroupFactory } from "../cellgroup/cellgroup-factory";
import { CellGroupExtCellRenderer } from "../../../renderer/cell-group-ext-cell-renderer";
// TODO next steps:   fix this model
export class AreaModelCellGroups {
    areaIdent;
    groups;
    columnDefs;
    defaultRowHeight;
    gammaCells = true;
    rowSelectionModel;
    arr;
    groupExts = [];
    cellGroupExtCellRenderer = new CellGroupExtCellRenderer();
    constructor(areaIdent = "header", groups, columnDefs = [], defaultRowHeight) {
        this.areaIdent = areaIdent;
        this.groups = groups;
        this.columnDefs = columnDefs;
        this.defaultRowHeight = defaultRowHeight;
        this.groupExts = CellgroupFactory.buildGroupExts(groups);
        console.info(this.groupExts);
        console.info(this.getAllLeafs());
        console.info(this.getMaxRowCount());
        for (const g of this.groupExts) {
            g.log(this.getMaxRowCount());
            //console.info(g.getAllRowCounts(g));
        }
        this.arr = this.buildArray();
        if (!this.columnDefs?.length && areaIdent === "header") {
            this.columnDefs = CellgroupFactory.buildColumnDefs(groups);
        }
        console.info('this.columnDefs', this.columnDefs);
        console.info('this.arr', this.arr);
    }
    getAllLeafs() {
        const flatten = CellgroupFactory.flattenGroupExts(this.groupExts);
        return flatten.filter(ge => !ge.children);
    }
    getMaxRowCount() {
        const allLeafs = this.getAllLeafs();
        if (allLeafs?.length) {
            return 1 + Math.max(...allLeafs.map(c => c.getParentCount(c)));
        }
        return 0;
    }
    buildArray() {
        console.info("");
        let flatten = CellgroupFactory.flattenGroupExts(this.groupExts);
        // console.info("flat", flatten);
        const maxCol = flatten.length;
        const maxRow = 1 + Math.max(...flatten.map(c => c.rowIndex));
        console.info("max  row/col:", maxRow + "/" + maxCol);
        const sb = [];
        CellgroupFactory.iterateThrowColumns(sb, this.groupExts);
        console.info(sb);
        const arrs = Array.from(Array(maxRow).keys()).map((_r) => []);
        let ret = CellgroupFactory.buildArrayOfArrays(flatten, arrs);
        console.table(ret);
        /*
    
    Gold                                                Hohenwarte
    Gold AB              Gold CD                        HOH AB                      HOH CD
    Gold A     Gold B    Gold C   Gold D    Gold Sum    HOH Loc    HOH A    HOH B   HOH C    HOH D
    
    */
        return ret;
    }
    changeColumnOrder(_sourceColumnIndex, _targetColumnIndex) {
        // skip
    }
    doSort(_sortItems) {
        return false;
    }
    externalFilterChanged(_predictFn) {
        // skip
    }
    getCellRenderer(_rowIndex, _columnIndex) {
        return this.cellGroupExtCellRenderer;
    }
    getColspanAt(rowIndex, columnIndex) {
        // let ret = 1;
        //
        // if (this.getValueAt(rowIndex, columnIndex)){
        //   const maxCol = this.arr[0].length;
        //   while (ret< maxCol && this.getValueAt(rowIndex, columnIndex + ret)===null){
        //     ret++;
        //   }
        // }
        // return ret;
        const val = this.getValueAt(rowIndex, columnIndex);
        if (val) {
            return val.getColumnCount();
        }
        return 0;
    }
    getCustomClassesAt(_rowIndex, _columnIndex) {
        return [];
    }
    getCustomStyleAt(_rowIndex, _columnIndex) {
        return undefined;
    }
    getMaxColspan() {
        return 12;
    }
    getMaxRowspan() {
        return 12;
    }
    getRowByIndex(_rowIndex) {
        return undefined;
    }
    getRowCount() {
        if (this.arr) {
            return this.arr.length;
        }
        return 0;
    }
    getRowspanAt(rowIndex, columnIndex) {
        // TODO
        const cge = this.getValueAt(rowIndex, columnIndex);
        if (cge) {
            const maxRowCount = this.getRowCount();
            return cge.getRowSpan(cge, maxRowCount);
        }
        return 0;
    }
    getTooltipAt(_rowIndex, _columnIndex) {
        // TODO
        return "";
    }
    getValueAt(rowIndex, columnIndex) {
        return this.arr[rowIndex][columnIndex];
    }
    getYPosByRowIndex(_rowIndex) {
        // TODO
        return 0;
    }
    init() {
    }
    getRowHeight(_rowIndex) {
        return this.defaultRowHeight;
    }
    isEditable(_rowIndex, _columnIndex) {
        return false;
    }
    isFilterable() {
        return false;
    }
    isRowCheckable(_rowIndex) {
        return false;
    }
    isRowChecked(_rowIndex) {
        return undefined;
    }
    isSelectable(_rowIndex, _columnIndex) {
        return false;
    }
    setRowChecked(_rowIndex, _checked) {
        // skipped
    }
    setValue(_rowIndex, _columnIndex, _value) {
        return false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJlYS1tb2RlbC1jZWxsLWdyb3Vwcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvdGFibGUvc3JjL2xpYi90YWJsZS9kYXRhL3RhYmxlbW9kZWwvYXJlYW1vZGVsL2FyZWEtbW9kZWwtY2VsbC1ncm91cHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBU0EsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFbEUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFFMUYsb0NBQW9DO0FBQ3BDLE1BQU0sT0FBTyxtQkFBbUI7SUFXWjtJQUNBO0lBQ0E7SUFDQTtJQVpYLFVBQVUsR0FBRyxJQUFJLENBQUM7SUFFbEIsaUJBQWlCLENBQW1DO0lBQzNDLEdBQUcsQ0FBd0M7SUFFbkQsU0FBUyxHQUFtQixFQUFFLENBQUM7SUFDL0Isd0JBQXdCLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDO0lBRWxFLFlBQ2tCLFlBQXVCLFFBQVEsRUFDL0IsTUFBcUIsRUFDckIsYUFBNEIsRUFBRSxFQUM5QixnQkFBd0I7UUFIeEIsY0FBUyxHQUFULFNBQVMsQ0FBc0I7UUFDL0IsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUNyQixlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQVE7UUFFeEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekQsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDN0IsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUNqQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLEtBQUssTUFBTSxDQUFD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dHlwZVwiO1xuaW1wb3J0IHsgQ29sdW1uRGVmSWYgfSBmcm9tIFwiLi4vY29sdW1uL2NvbHVtbi1kZWYuaWZcIjtcbmltcG9ydCB7IEFyZWFNb2RlbElmIH0gZnJvbSBcIi4vYXJlYS1tb2RlbC5pZlwiO1xuaW1wb3J0IHsgQ2VsbEdyb3VwSWYgfSBmcm9tIFwiLi4vY2VsbGdyb3VwL2NlbGwtZ3JvdXAuaWZcIjtcbmltcG9ydCB7IENoZWNrYm94TW9kZWxJZiB9IGZyb20gXCIuLi8uLi8uLi9jaGVja2JveC9jaGVja2JveC1tb2RlbC5pZlwiO1xuaW1wb3J0IHsgU29ydEl0ZW0gfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NvcnQtaXRlbVwiO1xuaW1wb3J0IHsgRmlsdGVyRnVuY3Rpb24gfSBmcm9tIFwiLi4vLi4vY29tbW9uL2ZpbHRlci1mdW5jdGlvblwiO1xuaW1wb3J0IHsgQ2VsbFJlbmRlcmVySWYgfSBmcm9tIFwiLi4vLi4vLi4vcmVuZGVyZXIvY2VsbC1yZW5kZXIuaWZcIjtcbmltcG9ydCB7IENoZWNrZWRUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9jaGVja2VkLXR5cGVcIjtcbmltcG9ydCB7IENlbGxncm91cEZhY3RvcnkgfSBmcm9tIFwiLi4vY2VsbGdyb3VwL2NlbGxncm91cC1mYWN0b3J5XCI7XG5pbXBvcnQgeyBDZWxsR3JvdXBFeHQgfSBmcm9tIFwiLi4vY2VsbGdyb3VwL2NlbGwtZ3JvdXAtZXh0XCI7XG5pbXBvcnQgeyBDZWxsR3JvdXBFeHRDZWxsUmVuZGVyZXIgfSBmcm9tIFwiLi4vLi4vLi4vcmVuZGVyZXIvY2VsbC1ncm91cC1leHQtY2VsbC1yZW5kZXJlclwiO1xuXG4vLyBUT0RPIG5leHQgc3RlcHM6ICAgZml4IHRoaXMgbW9kZWxcbmV4cG9ydCBjbGFzcyBBcmVhTW9kZWxDZWxsR3JvdXBzIGltcGxlbWVudHMgQXJlYU1vZGVsSWYge1xuXG4gIHB1YmxpYyBnYW1tYUNlbGxzID0gdHJ1ZTtcblxuICBwdWJsaWMgcm93U2VsZWN0aW9uTW9kZWw6IENoZWNrYm94TW9kZWxJZjxhbnk+IHwgdW5kZWZpbmVkO1xuICBwdWJsaWMgcmVhZG9ubHkgYXJyOiAoQ2VsbEdyb3VwRXh0IHwgbnVsbCB8IHVuZGVmaW5lZClbXVtdO1xuXG4gIHByaXZhdGUgZ3JvdXBFeHRzOiBDZWxsR3JvdXBFeHRbXSA9IFtdO1xuICBwcml2YXRlIGNlbGxHcm91cEV4dENlbGxSZW5kZXJlciA9IG5ldyBDZWxsR3JvdXBFeHRDZWxsUmVuZGVyZXIoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcmVhZG9ubHkgYXJlYUlkZW50OiBBcmVhSWRlbnQgPSBcImhlYWRlclwiLFxuICAgIHB1YmxpYyByZWFkb25seSBncm91cHM6IENlbGxHcm91cElmW10sXG4gICAgcHVibGljIHJlYWRvbmx5IGNvbHVtbkRlZnM6IENvbHVtbkRlZklmW10gPSBbXSxcbiAgICBwdWJsaWMgcmVhZG9ubHkgZGVmYXVsdFJvd0hlaWdodDogbnVtYmVyXG4gICkge1xuICAgIHRoaXMuZ3JvdXBFeHRzID0gQ2VsbGdyb3VwRmFjdG9yeS5idWlsZEdyb3VwRXh0cyhncm91cHMpO1xuICAgIGNvbnNvbGUuaW5mbyh0aGlzLmdyb3VwRXh0cyk7XG4gICAgY29uc29sZS5pbmZvKHRoaXMuZ2V0QWxsTGVhZnMoKSk7XG4gICAgY29uc29sZS5pbmZvKHRoaXMuZ2V0TWF4Um93Q291bnQoKSk7XG4gICAgZm9yIChjb25zdCBnIG9mIHRoaXMuZ3JvdXBFeHRzKSB7XG4gICAgICBnLmxvZyh0aGlzLmdldE1heFJvd0NvdW50KCkpO1xuICAgICAgLy9jb25zb2xlLmluZm8oZy5nZXRBbGxSb3dDb3VudHMoZykpO1xuICAgIH1cbiAgICB0aGlzLmFyciA9IHRoaXMuYnVpbGRBcnJheSgpO1xuXG4gICAgaWYgKCF0aGlzLmNvbHVtbkRlZnM/Lmxlbmd0aCAmJiBhcmVhSWRlbnQgPT09IFwiaGVhZGVyXCIpIHtcbiAgICAgIHRoaXMuY29sdW1uRGVmcyA9IENlbGxncm91cEZhY3RvcnkuYnVpbGRDb2x1bW5EZWZzKGdyb3Vwcyk7XG4gICAgfVxuICAgIGNvbnNvbGUuaW5mbygndGhpcy5jb2x1bW5EZWZzJywgdGhpcy5jb2x1bW5EZWZzKTtcbiAgICBjb25zb2xlLmluZm8oJ3RoaXMuYXJyJywgdGhpcy5hcnIpO1xuICB9XG5cbiAgZ2V0QWxsTGVhZnMoKTogQ2VsbEdyb3VwRXh0W10ge1xuICAgIGNvbnN0IGZsYXR0ZW4gPSBDZWxsZ3JvdXBGYWN0b3J5LmZsYXR0ZW5Hcm91cEV4dHModGhpcy5ncm91cEV4dHMpO1xuICAgIHJldHVybiBmbGF0dGVuLmZpbHRlcihnZSA9PiAhZ2UuY2hpbGRyZW4pO1xuICB9XG5cbiAgZ2V0TWF4Um93Q291bnQoKTogbnVtYmVyIHtcbiAgICBjb25zdCBhbGxMZWFmcyA9IHRoaXMuZ2V0QWxsTGVhZnMoKTtcbiAgICBpZiAoYWxsTGVhZnM/Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIDEgKyBNYXRoLm1heCguLi5hbGxMZWFmcy5tYXAoYyA9PiBjLmdldFBhcmVudENvdW50KGMpKSk7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9XG5cbiAgYnVpbGRBcnJheSgpOiAoQ2VsbEdyb3VwRXh0IHwgbnVsbCB8IHVuZGVmaW5lZClbXVtdIHtcbiAgICBjb25zb2xlLmluZm8oXCJcIik7XG4gICAgbGV0IGZsYXR0ZW4gPSBDZWxsZ3JvdXBGYWN0b3J5LmZsYXR0ZW5Hcm91cEV4dHModGhpcy5ncm91cEV4dHMpO1xuICAgIC8vIGNvbnNvbGUuaW5mbyhcImZsYXRcIiwgZmxhdHRlbik7XG5cbiAgICBjb25zdCBtYXhDb2wgPSBmbGF0dGVuLmxlbmd0aDtcbiAgICBjb25zdCBtYXhSb3cgPSAxICsgTWF0aC5tYXgoLi4uZmxhdHRlbi5tYXAoYyA9PiBjLnJvd0luZGV4KSk7XG4gICAgY29uc29sZS5pbmZvKFwibWF4ICByb3cvY29sOlwiLCBtYXhSb3cgKyBcIi9cIiArIG1heENvbCk7XG5cbiAgICBjb25zdCBzYjogc3RyaW5nW10gPSBbXTtcbiAgICBDZWxsZ3JvdXBGYWN0b3J5Lml0ZXJhdGVUaHJvd0NvbHVtbnMoc2IsIHRoaXMuZ3JvdXBFeHRzKTtcbiAgICBjb25zb2xlLmluZm8oc2IpO1xuXG4gICAgY29uc3QgYXJycyA9IEFycmF5LmZyb20oQXJyYXkobWF4Um93KS5rZXlzKCkpLm1hcCgoX3IpID0+IFtdKTtcbiAgICBsZXQgcmV0ID0gQ2VsbGdyb3VwRmFjdG9yeS5idWlsZEFycmF5T2ZBcnJheXMoZmxhdHRlbiwgYXJycyk7XG4gICAgY29uc29sZS50YWJsZShyZXQpO1xuXG4gICAgLypcblxuR29sZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvaGVud2FydGVcbkdvbGQgQUIgICAgICAgICAgICAgIEdvbGQgQ0QgICAgICAgICAgICAgICAgICAgICAgICBIT0ggQUIgICAgICAgICAgICAgICAgICAgICAgSE9IIENEXG5Hb2xkIEEgICAgIEdvbGQgQiAgICBHb2xkIEMgICBHb2xkIEQgICAgR29sZCBTdW0gICAgSE9IIExvYyAgICBIT0ggQSAgICBIT0ggQiAgIEhPSCBDICAgIEhPSCBEXG5cbiovXG4gICAgcmV0dXJuIHJldDtcbiAgfVxuXG4gIGNoYW5nZUNvbHVtbk9yZGVyKF9zb3VyY2VDb2x1bW5JbmRleDogbnVtYmVyLCBfdGFyZ2V0Q29sdW1uSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIC8vIHNraXBcbiAgfVxuXG4gIGRvU29ydChfc29ydEl0ZW1zOiBTb3J0SXRlbVtdKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZXh0ZXJuYWxGaWx0ZXJDaGFuZ2VkPFQ+KF9wcmVkaWN0Rm46IEZpbHRlckZ1bmN0aW9uPFQ+KTogdm9pZCB7XG4gICAgLy8gc2tpcFxuICB9XG5cbiAgZ2V0Q2VsbFJlbmRlcmVyKF9yb3dJbmRleDogbnVtYmVyLCBfY29sdW1uSW5kZXg6IG51bWJlcik6IENlbGxSZW5kZXJlcklmIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5jZWxsR3JvdXBFeHRDZWxsUmVuZGVyZXI7XG4gIH1cblxuICBnZXRDb2xzcGFuQXQocm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgLy8gbGV0IHJldCA9IDE7XG4gICAgLy9cbiAgICAvLyBpZiAodGhpcy5nZXRWYWx1ZUF0KHJvd0luZGV4LCBjb2x1bW5JbmRleCkpe1xuICAgIC8vICAgY29uc3QgbWF4Q29sID0gdGhpcy5hcnJbMF0ubGVuZ3RoO1xuICAgIC8vICAgd2hpbGUgKHJldDwgbWF4Q29sICYmIHRoaXMuZ2V0VmFsdWVBdChyb3dJbmRleCwgY29sdW1uSW5kZXggKyByZXQpPT09bnVsbCl7XG4gICAgLy8gICAgIHJldCsrO1xuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyByZXR1cm4gcmV0O1xuXG4gICAgY29uc3QgdmFsID0gdGhpcy5nZXRWYWx1ZUF0KHJvd0luZGV4LCBjb2x1bW5JbmRleCk7XG4gICAgaWYgKHZhbCkge1xuICAgICAgcmV0dXJuIHZhbC5nZXRDb2x1bW5Db3VudCgpO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGdldEN1c3RvbUNsYXNzZXNBdChfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgZ2V0Q3VzdG9tU3R5bGVBdChfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiB7IFtwOiBzdHJpbmddOiBzdHJpbmcgfSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldE1heENvbHNwYW4oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gMTI7XG4gIH1cblxuICBnZXRNYXhSb3dzcGFuKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDEyO1xuICB9XG5cbiAgZ2V0Um93QnlJbmRleChfcm93SW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldFJvd0NvdW50KCk6IG51bWJlciB7XG4gICAgaWYgKHRoaXMuYXJyKSB7XG4gICAgICByZXR1cm4gdGhpcy5hcnIubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG5cbiAgZ2V0Um93c3BhbkF0KHJvd0luZGV4OiBudW1iZXIsIGNvbHVtbkluZGV4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIFRPRE9cbiAgICBjb25zdCBjZ2U6IENlbGxHcm91cEV4dCB8IG51bGwgfCB1bmRlZmluZWQgPSB0aGlzLmdldFZhbHVlQXQocm93SW5kZXgsIGNvbHVtbkluZGV4KTtcbiAgICBpZiAoY2dlKXtcbiAgICAgIGNvbnN0IG1heFJvd0NvdW50ID0gdGhpcy5nZXRSb3dDb3VudCgpO1xuICAgICAgcmV0dXJuIGNnZS5nZXRSb3dTcGFuKGNnZSwgbWF4Um93Q291bnQpO1xuICAgIH1cbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGdldFRvb2x0aXBBdChfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIC8vIFRPRE9cbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuXG4gIGdldFZhbHVlQXQocm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuYXJyW3Jvd0luZGV4XVtjb2x1bW5JbmRleF07XG4gIH1cblxuICBnZXRZUG9zQnlSb3dJbmRleChfcm93SW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgLy8gVE9ET1xuICAgIHJldHVybiAwO1xuICB9XG5cblxuICBpbml0KCk6IHZvaWQge1xuICB9XG5cbiAgZ2V0Um93SGVpZ2h0KF9yb3dJbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0Um93SGVpZ2h0O1xuICB9XG5cbiAgaXNFZGl0YWJsZShfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc0ZpbHRlcmFibGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaXNSb3dDaGVja2FibGUoX3Jvd0luZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpc1Jvd0NoZWNrZWQoX3Jvd0luZGV4OiBudW1iZXIpOiBDaGVja2VkVHlwZSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlzU2VsZWN0YWJsZShfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzZXRSb3dDaGVja2VkKF9yb3dJbmRleDogbnVtYmVyLCBfY2hlY2tlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIC8vIHNraXBwZWRcbiAgfVxuXG4gIHNldFZhbHVlKF9yb3dJbmRleDogbnVtYmVyLCBfY29sdW1uSW5kZXg6IG51bWJlciwgX3ZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxufVxuIl19