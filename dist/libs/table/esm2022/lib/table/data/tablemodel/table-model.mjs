import { Padding } from "./padding";
import { DefaultRowHeights } from "../options/default-row-heights";
import { CheckboxColumnDef } from "../common/checkbox-column-def";
import { CheckboxModel } from "../../checkbox/checkbox-model";
/**
 * This is a default implementation of TableModelIf.
 * Ths TableModel is on one hand a container for the header, body, and footer models
 * (see : #getAreaModel, and #AreaModelIf), and on the other hand the master of
 * the column information (#getColumnCount(), #getColumnWidth(columnIndex: number)).
 *
 * If getFixedLeftColumnCount() returns a value greater than 0, a fixed west area will be rendered in the
 * header, body, and footer. A value greater than 0 for getFixedLeftColumnCount()
 * will result in the presence of an east area.
 *
 * <pre>
 *  +----------------+-------------------+--------------+
 *  |  header/west   |  header/center    | header/east  |
 *  +----------------+-------------------+--------------+
 *  |  body/west     |  body/center      | body/east    |
 *  +----------------+-------------------+--------------+
 *  |  footer/west   |  footer/center    | footer/east  |
 *  +----------------+-------------------+--------------+ </pre>
 *
 */
export class TableModel {
    headerAreaModel;
    bodyAreaModel;
    footerAreaModel;
    fixedLeftColumnCount;
    fixedRightColumnCount;
    rowCheckboxVisible;
    defaultRowHeights;
    columnDefs;
    columnSizes;
    overridingColumnWidth;
    columnCount;
    parentSize;
    getSelectionModel;
    rowCount = 0;
    contentHeightInPx = 0;
    contentWidthInPx = 0;
    // in case of a fixed header, left or right column, footer:
    padding = new Padding(0, 0, 0, 0); // the dimension of the 'body/center'
    xPositions = [];
    constructor(headerAreaModel, bodyAreaModel, footerAreaModel, fixedLeftColumnCount = 0, fixedRightColumnCount = 0, rowCheckboxVisible = false, defaultRowHeights = new DefaultRowHeights(), columnDefs = [], columnSizes = [], overridingColumnWidth = -1, columnCount = 0, parentSize = 400, // can be important when we have percentage widthes,
    getSelectionModel = () => undefined) {
        this.headerAreaModel = headerAreaModel;
        this.bodyAreaModel = bodyAreaModel;
        this.footerAreaModel = footerAreaModel;
        this.fixedLeftColumnCount = fixedLeftColumnCount;
        this.fixedRightColumnCount = fixedRightColumnCount;
        this.rowCheckboxVisible = rowCheckboxVisible;
        this.defaultRowHeights = defaultRowHeights;
        this.columnDefs = columnDefs;
        this.columnSizes = columnSizes;
        this.overridingColumnWidth = overridingColumnWidth;
        this.columnCount = columnCount;
        this.parentSize = parentSize;
        this.getSelectionModel = getSelectionModel;
        headerAreaModel.areaIdent = "header";
        bodyAreaModel.areaIdent = "body";
        footerAreaModel.areaIdent = "footer";
        if (!this.columnCount) {
            if (this.columnDefs?.length) {
                this.columnCount = this.columnDefs.length;
            }
            else if (this.columnSizes?.length) {
                this.columnCount = this.columnSizes?.length;
            }
        }
        if (this.columnDefs?.length
            && this.columnDefs[0] instanceof CheckboxColumnDef
            && !bodyAreaModel.rowSelectionModel) {
            bodyAreaModel.rowSelectionModel = new CheckboxModel();
        }
    }
    init() {
        this.recalcSize(this.parentSize);
        if (this.overridingColumnWidth === -1) {
            this.calcXPositions();
        }
        if (this.headerAreaModel) {
            this.headerAreaModel.init();
        }
        if (this.bodyAreaModel) {
            this.bodyAreaModel.init();
        }
        if (this.footerAreaModel) {
            this.footerAreaModel.init();
        }
    }
    getColumnCount() {
        return this.columnCount;
    }
    ;
    setColumnWidth(columnIndex, width) {
        width = Math.max(0, width);
        if (this.overridingColumnWidth !== -1) {
            this.overridingColumnWidth = width;
        }
        if (columnIndex > -1 && columnIndex < this.columnSizes?.length) {
            this.columnSizes[columnIndex] = width;
        }
        this.recalcContentWidthInPx();
    }
    getColumnWidth(columnIndex) {
        const cd = this.getColumnDef(columnIndex);
        if (cd && cd.isVisible && !cd.isVisible()) {
            return 0;
        }
        if (this.overridingColumnWidth !== -1) {
            return this.overridingColumnWidth;
        }
        if (columnIndex > -1 && columnIndex < this.columnSizes?.length) {
            return this.columnSizes[columnIndex];
        }
        return 0;
    }
    ;
    getXPosByColumnIndex(columnIndex) {
        if (columnIndex === 0) {
            return 0;
        }
        if (this.overridingColumnWidth > -1) {
            return this.overridingColumnWidth * columnIndex;
        }
        return this.xPositions[columnIndex];
    }
    recalcSize(clientWidth) {
        this.recalcColumnWidthes(clientWidth);
        this.recalcHeightAndPadding();
    }
    recalcHeightAndPadding() {
        const bodyModel = this.getAreaModel("body");
        this.rowCount = bodyModel.getRowCount();
        this.contentHeightInPx = this.getAreaHeight("body");
        this.recalcContentWidthInPx();
        this.recalcPadding();
    }
    recalcPadding() {
        const westWidth = this.getSideAreaWidth("west");
        const eastWidth = this.getSideAreaWidth("east");
        const headerHeight = this.getAreaHeight("header");
        const footerHeight = this.getAreaHeight("footer");
        this.padding = new Padding(headerHeight, eastWidth, footerHeight, westWidth);
    }
    getPadding() {
        return this.padding;
    }
    getContentHeightInPixel() {
        return this.contentHeightInPx;
    }
    getContentWidthInPixel() {
        return this.contentWidthInPx;
    }
    getRowHeight(rowAreaIdent, rowIndex) {
        return this.getAreaModel(rowAreaIdent).getRowHeight(rowIndex);
    }
    getModel(rowAreaIdent) {
        return this.getAreaModel(rowAreaIdent);
    }
    getAreaHeight(areaIdent) {
        const model = this.getModel(areaIdent);
        const rowCount = model.getRowCount();
        if (this.defaultRowHeights[areaIdent]) {
            return rowCount * this.defaultRowHeights[areaIdent];
        }
        let ret = 0;
        for (let i = 0; i < rowCount; i++) {
            ret = ret + model.getRowHeight(i);
        }
        return ret;
    }
    getSideAreaWidth(sideIdent) {
        const [cStart, cEnd] = this.getSideStartAndEndColumnIndex(sideIdent);
        let ret = 0;
        for (let i = cStart; i <= cEnd; i++) {
            ret = ret + this.getColumnWidth(i);
        }
        return ret;
    }
    getSideStartAndEndColumnIndex(sideIdent) {
        const c1 = this.getFixedLeftColumnCount();
        const c2 = this.getFixedRightColumnCount();
        let cStart = 0;
        let cEnd = this.columnCount - 1;
        if (sideIdent === "west") {
            cEnd = c1 - 1;
        }
        else if (sideIdent === "east") {
            cStart = this.columnCount - c2;
        }
        else {
            // center:
            cStart = c1;
            cEnd = this.columnCount - c2 - 1;
        }
        return [cStart, cEnd];
    }
    getColumnDef(index) {
        if (index < this.columnDefs.length) {
            return this.columnDefs[index];
        }
        return undefined;
    }
    getFixedLeftColumnCount() {
        return this.fixedLeftColumnCount;
    }
    getFixedRightColumnCount() {
        return this.fixedRightColumnCount;
    }
    getAreaModel(area) {
        if (area === "header") {
            return this.headerAreaModel;
        }
        if (area === "body") {
            return this.bodyAreaModel;
        }
        if (area === "footer") {
            return this.footerAreaModel;
        }
        throw new Error("Wrong ident.");
    }
    getBodyModel() {
        return this.bodyAreaModel;
    }
    isFooterVisibe() {
        return (this.footerAreaModel?.getRowCount() ?? 0) > 0;
    }
    isHeaderVisibe() {
        return (this.headerAreaModel?.getRowCount() ?? 0) > 0;
    }
    isRowCheckboxVisible() {
        return this.rowCheckboxVisible;
    }
    externalFilterChanged(predictFn) {
        this.getAreaModel("body").externalFilterChanged(predictFn);
    }
    doSort(sortItems) {
        return this.getAreaModel("body").doSort(sortItems);
    }
    getColumnDefs() {
        return this.columnDefs;
    }
    getColumnProperty(columnIndex) {
        return this.columnDefs[columnIndex].property;
    }
    getBodyRowByIndex(rowIndex) {
        return this.getBodyModel().getRowByIndex(rowIndex);
    }
    isSortable(columnIndex) {
        if (this.columnDefs
            && columnIndex < this.columnDefs.length
            && this.columnDefs[columnIndex].sortable) {
            // @ts-ignore
            return this.columnDefs[columnIndex].sortable();
        }
        return false;
    }
    changeColumnOrder(sourceColumnIndex, targetColumnIndex) {
        this.arrayMove(this.columnDefs, sourceColumnIndex, targetColumnIndex);
        this.arrayMove(this.columnSizes, sourceColumnIndex, targetColumnIndex);
        this.headerAreaModel?.changeColumnOrder(sourceColumnIndex, targetColumnIndex);
        this.bodyAreaModel?.changeColumnOrder(sourceColumnIndex, targetColumnIndex);
        this.footerAreaModel?.changeColumnOrder(sourceColumnIndex, targetColumnIndex);
        this.calcXPositions();
    }
    recalcColumnWidthes(clientWidth) {
        if (!this.columnDefs?.length && !this.columnSizes?.length) {
            this.columnSizes = new Array(this.getColumnCount()).fill(this.overridingColumnWidth);
        }
        if (this.columnDefs?.length) {
            this.columnSizes = this.columnDefs.map(def => {
                if (def.width.unit === "%" && clientWidth) {
                    // only for a % value we have to check min and max:
                    let px = Math.floor(def.width.value * clientWidth / 100);
                    if (def.minWidth) {
                        let pxMin = def.minWidth.unit === "px" ? def.minWidth.value : Math.floor(def.minWidth.value * clientWidth / 100);
                        px = Math.max(pxMin, px);
                    }
                    if (def.maxWidth) {
                        let pxMax = def.maxWidth.unit === "px" ? def.maxWidth.value : Math.floor(def.maxWidth.value * clientWidth / 100);
                        px = Math.min(pxMax, px);
                    }
                    return px;
                }
                return def.width.value;
            });
        }
    }
    arrayMove(arr, fromIndex, toIndex) {
        const element = arr.splice(fromIndex, 1)[0];
        arr.splice(toIndex, 0, element);
        return arr;
    }
    recalcContentWidthInPx() {
        this.contentWidthInPx = this.getSideAreaWidth("center");
    }
    calcXPositions() {
        const columnCount = this.getColumnCount();
        this.xPositions = new Array(columnCount + 1);
        this.xPositions[0] = 0;
        for (let i = 0; i < columnCount; i++) {
            this.xPositions[i + 1] = this.getColumnWidth(i) + this.xPositions[i];
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUtbW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3RhYmxlL3NyYy9saWIvdGFibGUvZGF0YS90YWJsZW1vZGVsL3RhYmxlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFLcEMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFNbkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBRzlEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBbUJHO0FBQ0gsTUFBTSxPQUFPLFVBQVU7SUFXSDtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNUO0lBQ0E7SUFDRztJQUNBO0lBQ0E7SUFDTTtJQXJCUixRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBQ2IsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLGdCQUFnQixHQUFHLENBQUMsQ0FBQztJQUUvQiwyREFBMkQ7SUFDakQsT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMscUNBQXFDO0lBQ3hFLFVBQVUsR0FBYSxFQUFFLENBQUM7SUFFcEMsWUFDa0IsZUFBNEIsRUFDNUIsYUFBMEIsRUFDMUIsZUFBNEIsRUFDNUIsdUJBQStCLENBQUMsRUFDaEMsd0JBQWdDLENBQUMsRUFDakMscUJBQThCLEtBQUssRUFDbkMsb0JBQXlDLElBQUksaUJBQWlCLEVBQUUsRUFDekUsYUFBNEIsRUFBRSxFQUM5QixjQUF3QixFQUFFLEVBQ3ZCLHdCQUFnQyxDQUFDLENBQUMsRUFDbEMsY0FBc0IsQ0FBQyxFQUN2QixhQUFxQixHQUFHLEVBQUUsb0RBQW9EO0lBQ3hF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Z0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRU8sY0FBYztRQUNwQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEtBQUssQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDdEU7SUFDSCxDQUFDO0NBR0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUYWJsZU1vZGVsSWYgfSBmcm9tIFwiLi90YWJsZS1tb2RlbC5pZlwiO1xuaW1wb3J0IHsgUGFkZGluZyB9IGZyb20gXCIuL3BhZGRpbmdcIjtcbmltcG9ydCB7IEFyZWFJZGVudCB9IGZyb20gXCIuL2FyZWEtaWRlbnQudHlwZVwiO1xuaW1wb3J0IHsgQXJlYU1vZGVsSWYgfSBmcm9tIFwiLi9hcmVhbW9kZWwvYXJlYS1tb2RlbC5pZlwiO1xuaW1wb3J0IHsgU2lkZUlkZW50IH0gZnJvbSBcIi4uL3NpZGUtaWRlbnQudHlwZVwiO1xuaW1wb3J0IHsgRGVmYXVsdFJvd0hlaWdodHNJZiB9IGZyb20gXCIuLi9vcHRpb25zL2RlZmF1bHQtcm93LWhlaWdodHMuaWZcIjtcbmltcG9ydCB7IERlZmF1bHRSb3dIZWlnaHRzIH0gZnJvbSBcIi4uL29wdGlvbnMvZGVmYXVsdC1yb3ctaGVpZ2h0c1wiO1xuaW1wb3J0IHsgQ29sdW1uRGVmSWYgfSBmcm9tIFwiLi9jb2x1bW4vY29sdW1uLWRlZi5pZlwiO1xuaW1wb3J0IHsgRmlsdGVyRnVuY3Rpb24gfSBmcm9tIFwiLi4vY29tbW9uL2ZpbHRlci1mdW5jdGlvblwiO1xuaW1wb3J0IHsgU29ydEl0ZW0gfSBmcm9tIFwiLi4vY29tbW9uL3NvcnQtaXRlbVwiO1xuaW1wb3J0IHsgU2VsZWN0aW9uTW9kZWxJZiB9IGZyb20gXCIuLi8uLi9zZWxlY3Rpb24vc2VsZWN0aW9uLW1vZGVsLmlmXCI7XG5pbXBvcnQgeyBHZXRUIH0gZnJvbSBcIi4uL2NvbW1vbi9nZXQtdFwiO1xuaW1wb3J0IHsgQ2hlY2tib3hDb2x1bW5EZWYgfSBmcm9tIFwiLi4vY29tbW9uL2NoZWNrYm94LWNvbHVtbi1kZWZcIjtcbmltcG9ydCB7IENoZWNrYm94TW9kZWwgfSBmcm9tIFwiLi4vLi4vY2hlY2tib3gvY2hlY2tib3gtbW9kZWxcIjtcblxuXG4vKipcbiAqIFRoaXMgaXMgYSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIFRhYmxlTW9kZWxJZi5cbiAqIFRocyBUYWJsZU1vZGVsIGlzIG9uIG9uZSBoYW5kIGEgY29udGFpbmVyIGZvciB0aGUgaGVhZGVyLCBib2R5LCBhbmQgZm9vdGVyIG1vZGVsc1xuICogKHNlZSA6ICNnZXRBcmVhTW9kZWwsIGFuZCAjQXJlYU1vZGVsSWYpLCBhbmQgb24gdGhlIG90aGVyIGhhbmQgdGhlIG1hc3RlciBvZlxuICogdGhlIGNvbHVtbiBpbmZvcm1hdGlvbiAoI2dldENvbHVtbkNvdW50KCksICNnZXRDb2x1bW5XaWR0aChjb2x1bW5JbmRleDogbnVtYmVyKSkuXG4gKlxuICogSWYgZ2V0Rml4ZWRMZWZ0Q29sdW1uQ291bnQoKSByZXR1cm5zIGEgdmFsdWUgZ3JlYXRlciB0aGFuIDAsIGEgZml4ZWQgd2VzdCBhcmVhIHdpbGwgYmUgcmVuZGVyZWQgaW4gdGhlXG4gKiBoZWFkZXIsIGJvZHksIGFuZCBmb290ZXIuIEEgdmFsdWUgZ3JlYXRlciB0aGFuIDAgZm9yIGdldEZpeGVkTGVmdENvbHVtbkNvdW50KClcbiAqIHdpbGwgcmVzdWx0IGluIHRoZSBwcmVzZW5jZSBvZiBhbiBlYXN0IGFyZWEuXG4gKlxuICogPHByZT5cbiAqICArLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tK1xuICogIHwgIGhlYWRlci93ZXN0ICAgfCAgaGVhZGVyL2NlbnRlciAgICB8IGhlYWRlci9lYXN0ICB8XG4gKiAgKy0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLStcbiAqICB8ICBib2R5L3dlc3QgICAgIHwgIGJvZHkvY2VudGVyICAgICAgfCBib2R5L2Vhc3QgICAgfFxuICogICstLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0rXG4gKiAgfCAgZm9vdGVyL3dlc3QgICB8ICBmb290ZXIvY2VudGVyICAgIHwgZm9vdGVyL2Vhc3QgIHxcbiAqICArLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tKyA8L3ByZT5cbiAqXG4gKi9cbmV4cG9ydCBjbGFzcyBUYWJsZU1vZGVsIGltcGxlbWVudHMgVGFibGVNb2RlbElmIHtcblxuICBwcm90ZWN0ZWQgcm93Q291bnQgPSAwO1xuICBwcm90ZWN0ZWQgY29udGVudEhlaWdodEluUHggPSAwO1xuICBwcm90ZWN0ZWQgY29udGVudFdpZHRoSW5QeCA9IDA7XG5cbiAgLy8gaW4gY2FzZSBvZiBhIGZpeGVkIGhlYWRlciwgbGVmdCBvciByaWdodCBjb2x1bW4sIGZvb3RlcjpcbiAgcHJvdGVjdGVkIHBhZGRpbmcgPSBuZXcgUGFkZGluZygwLCAwLCAwLCAwKTsgLy8gdGhlIGRpbWVuc2lvbiBvZiB0aGUgJ2JvZHkvY2VudGVyJ1xuICBwcm90ZWN0ZWQgeFBvc2l0aW9uczogbnVtYmVyW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgcmVhZG9ubHkgaGVhZGVyQXJlYU1vZGVsOiBBcmVhTW9kZWxJZixcbiAgICBwdWJsaWMgcmVhZG9ubHkgYm9keUFyZWFNb2RlbDogQXJlYU1vZGVsSWYsXG4gICAgcHVibGljIHJlYWRvbmx5IGZvb3RlckFyZWFNb2RlbDogQXJlYU1vZGVsSWYsXG4gICAgcHVibGljIHJlYWRvbmx5IGZpeGVkTGVmdENvbHVtbkNvdW50OiBudW1iZXIgPSAwLFxuICAgIHB1YmxpYyByZWFkb25seSBmaXhlZFJpZ2h0Q29sdW1uQ291bnQ6IG51bWJlciA9IDAsXG4gICAgcHVibGljIHJlYWRvbmx5IHJvd0NoZWNrYm94VmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlLFxuICAgIHB1YmxpYyByZWFkb25seSBkZWZhdWx0Um93SGVpZ2h0czogRGVmYXVsdFJvd0hlaWdodHNJZiA9IG5ldyBEZWZhdWx0Um93SGVpZ2h0cygpLFxuICAgIHB1YmxpYyBjb2x1bW5EZWZzOiBDb2x1bW5EZWZJZltdID0gW10sXG4gICAgcHVibGljIGNvbHVtblNpemVzOiBudW1iZXJbXSA9IFtdLFxuICAgIHByb3RlY3RlZCBvdmVycmlkaW5nQ29sdW1uV2lkdGg6IG51bWJlciA9IC0xLFxuICAgIHByb3RlY3RlZCBjb2x1bW5Db3VudDogbnVtYmVyID0gMCxcbiAgICBwcm90ZWN0ZWQgcGFyZW50U2l6ZTogbnVtYmVyID0gNDAwLCAvLyBjYW4gYmUgaW1wb3J0YW50IHdoZW4gd2UgaGF2ZSBwZXJjZW50YWdlIHdpZHRoZXMsXG4gICAgcHVibGljIHJlYWRvbmx5IGdldFNlbGVjdGlvbk1vZGVsOiBHZXRUPFNlbGVjdGlvbk1vZGVsSWY+ID0gKCkgPT4gdW5kZWZpbmVkXG4gICkge1xuICAgIGhlYWRlckFyZWFNb2RlbC5hcmVhSWRlbnQgPSBcImhlYWRlclwiO1xuICAgIGJvZHlBcmVhTW9kZWwuYXJlYUlkZW50ID0gXCJib2R5XCI7XG4gICAgZm9vdGVyQXJlYU1vZGVsLmFyZWFJZGVudCA9IFwiZm9vdGVyXCI7XG4gICAgaWYgKCF0aGlzLmNvbHVtbkNvdW50KSB7XG4gICAgICBpZiAodGhpcy5jb2x1bW5EZWZzPy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5jb2x1bW5Db3VudCA9IHRoaXMuY29sdW1uRGVmcy5sZW5ndGg7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29sdW1uU2l6ZXM/Lmxlbmd0aCkge1xuICAgICAgICB0aGlzLmNvbHVtbkNvdW50ID0gdGhpcy5jb2x1bW5TaXplcz8ubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5jb2x1bW5EZWZzPy5sZW5ndGhcbiAgICAgICYmIHRoaXMuY29sdW1uRGVmc1swXSBpbnN0YW5jZW9mIENoZWNrYm94Q29sdW1uRGVmXG4gICAgICAmJiAhYm9keUFyZWFNb2RlbC5yb3dTZWxlY3Rpb25Nb2RlbCkge1xuICAgICAgYm9keUFyZWFNb2RlbC5yb3dTZWxlY3Rpb25Nb2RlbCA9IG5ldyBDaGVja2JveE1vZGVsKCk7XG4gICAgfVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLnJlY2FsY1NpemUodGhpcy5wYXJlbnRTaXplKTtcbiAgICBpZiAodGhpcy5vdmVycmlkaW5nQ29sdW1uV2lkdGggPT09IC0xKSB7XG4gICAgICB0aGlzLmNhbGNYUG9zaXRpb25zKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmhlYWRlckFyZWFNb2RlbCkge1xuICAgICAgdGhpcy5oZWFkZXJBcmVhTW9kZWwuaW5pdCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5ib2R5QXJlYU1vZGVsKSB7XG4gICAgICB0aGlzLmJvZHlBcmVhTW9kZWwuaW5pdCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mb290ZXJBcmVhTW9kZWwpIHtcbiAgICAgIHRoaXMuZm9vdGVyQXJlYU1vZGVsLmluaXQoKTtcbiAgICB9XG4gIH1cblxuICBnZXRDb2x1bW5Db3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbkNvdW50O1xuICB9O1xuXG4gIHNldENvbHVtbldpZHRoKGNvbHVtbkluZGV4OiBudW1iZXIsIHdpZHRoOiBudW1iZXIpOiB2b2lkIHtcbiAgICB3aWR0aCA9IE1hdGgubWF4KDAsIHdpZHRoKTtcbiAgICBpZiAodGhpcy5vdmVycmlkaW5nQ29sdW1uV2lkdGggIT09IC0xKSB7XG4gICAgICB0aGlzLm92ZXJyaWRpbmdDb2x1bW5XaWR0aCA9IHdpZHRoO1xuICAgIH1cbiAgICBpZiAoY29sdW1uSW5kZXggPiAtMSAmJiBjb2x1bW5JbmRleCA8IHRoaXMuY29sdW1uU2l6ZXM/Lmxlbmd0aCkge1xuICAgICAgdGhpcy5jb2x1bW5TaXplc1tjb2x1bW5JbmRleF0gPSB3aWR0aDtcbiAgICB9XG4gICAgdGhpcy5yZWNhbGNDb250ZW50V2lkdGhJblB4KCk7XG4gIH1cblxuICBnZXRDb2x1bW5XaWR0aChjb2x1bW5JbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBjZCA9IHRoaXMuZ2V0Q29sdW1uRGVmKGNvbHVtbkluZGV4KTtcbiAgICBpZiAoY2QgJiYgY2QuaXNWaXNpYmxlICYmICFjZC5pc1Zpc2libGUoKSkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGlmICh0aGlzLm92ZXJyaWRpbmdDb2x1bW5XaWR0aCAhPT0gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLm92ZXJyaWRpbmdDb2x1bW5XaWR0aDtcbiAgICB9XG4gICAgaWYgKGNvbHVtbkluZGV4ID4gLTEgJiYgY29sdW1uSW5kZXggPCB0aGlzLmNvbHVtblNpemVzPy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbHVtblNpemVzW2NvbHVtbkluZGV4XTtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH07XG5cbiAgZ2V0WFBvc0J5Q29sdW1uSW5kZXgoY29sdW1uSW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgaWYgKGNvbHVtbkluZGV4ID09PSAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgaWYgKHRoaXMub3ZlcnJpZGluZ0NvbHVtbldpZHRoID4gLTEpIHtcbiAgICAgIHJldHVybiB0aGlzLm92ZXJyaWRpbmdDb2x1bW5XaWR0aCAqIGNvbHVtbkluZGV4O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy54UG9zaXRpb25zW2NvbHVtbkluZGV4XTtcbiAgfVxuXG4gIHJlY2FsY1NpemUoY2xpZW50V2lkdGg6IG51bWJlcikge1xuICAgIHRoaXMucmVjYWxjQ29sdW1uV2lkdGhlcyhjbGllbnRXaWR0aCk7XG4gICAgdGhpcy5yZWNhbGNIZWlnaHRBbmRQYWRkaW5nKCk7XG4gIH1cblxuICByZWNhbGNIZWlnaHRBbmRQYWRkaW5nKCkge1xuICAgIGNvbnN0IGJvZHlNb2RlbCA9IHRoaXMuZ2V0QXJlYU1vZGVsKFwiYm9keVwiKTtcbiAgICB0aGlzLnJvd0NvdW50ID0gYm9keU1vZGVsLmdldFJvd0NvdW50KCk7XG4gICAgdGhpcy5jb250ZW50SGVpZ2h0SW5QeCA9IHRoaXMuZ2V0QXJlYUhlaWdodChcImJvZHlcIik7XG4gICAgdGhpcy5yZWNhbGNDb250ZW50V2lkdGhJblB4KCk7XG5cbiAgICB0aGlzLnJlY2FsY1BhZGRpbmcoKTtcbiAgfVxuXG4gIHJlY2FsY1BhZGRpbmcoKSB7XG4gICAgY29uc3Qgd2VzdFdpZHRoID0gdGhpcy5nZXRTaWRlQXJlYVdpZHRoKFwid2VzdFwiKTtcbiAgICBjb25zdCBlYXN0V2lkdGggPSB0aGlzLmdldFNpZGVBcmVhV2lkdGgoXCJlYXN0XCIpO1xuICAgIGNvbnN0IGhlYWRlckhlaWdodCA9IHRoaXMuZ2V0QXJlYUhlaWdodChcImhlYWRlclwiKTtcbiAgICBjb25zdCBmb290ZXJIZWlnaHQgPSB0aGlzLmdldEFyZWFIZWlnaHQoXCJmb290ZXJcIik7XG5cbiAgICB0aGlzLnBhZGRpbmcgPSBuZXcgUGFkZGluZyhcbiAgICAgIGhlYWRlckhlaWdodCxcbiAgICAgIGVhc3RXaWR0aCxcbiAgICAgIGZvb3RlckhlaWdodCxcbiAgICAgIHdlc3RXaWR0aCk7XG4gIH1cblxuICBnZXRQYWRkaW5nKCk6IFBhZGRpbmcge1xuICAgIHJldHVybiB0aGlzLnBhZGRpbmc7XG4gIH1cblxuICBnZXRDb250ZW50SGVpZ2h0SW5QaXhlbCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRIZWlnaHRJblB4O1xuICB9XG5cbiAgZ2V0Q29udGVudFdpZHRoSW5QaXhlbCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRXaWR0aEluUHg7XG4gIH1cblxuICBnZXRSb3dIZWlnaHQocm93QXJlYUlkZW50OiBBcmVhSWRlbnQsIHJvd0luZGV4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmdldEFyZWFNb2RlbChyb3dBcmVhSWRlbnQpLmdldFJvd0hlaWdodChyb3dJbmRleCk7XG4gIH1cblxuICBnZXRNb2RlbChyb3dBcmVhSWRlbnQ6IEFyZWFJZGVudCk6IEFyZWFNb2RlbElmIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBcmVhTW9kZWwocm93QXJlYUlkZW50KTtcbiAgfVxuXG4gIGdldEFyZWFIZWlnaHQoYXJlYUlkZW50OiBBcmVhSWRlbnQpOiBudW1iZXIge1xuICAgIGNvbnN0IG1vZGVsID0gdGhpcy5nZXRNb2RlbChhcmVhSWRlbnQpO1xuICAgIGNvbnN0IHJvd0NvdW50ID0gbW9kZWwuZ2V0Um93Q291bnQoKTtcbiAgICBpZiAodGhpcy5kZWZhdWx0Um93SGVpZ2h0c1thcmVhSWRlbnRdKSB7XG4gICAgICByZXR1cm4gcm93Q291bnQgKiB0aGlzLmRlZmF1bHRSb3dIZWlnaHRzW2FyZWFJZGVudF07XG4gICAgfVxuXG4gICAgbGV0IHJldCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dDb3VudDsgaSsrKSB7XG4gICAgICByZXQgPSByZXQgKyBtb2RlbC5nZXRSb3dIZWlnaHQoaSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH1cblxuICBnZXRTaWRlQXJlYVdpZHRoKHNpZGVJZGVudDogU2lkZUlkZW50KTogbnVtYmVyIHtcbiAgICBjb25zdCBbY1N0YXJ0LCBjRW5kXSA9IHRoaXMuZ2V0U2lkZVN0YXJ0QW5kRW5kQ29sdW1uSW5kZXgoc2lkZUlkZW50KTtcbiAgICBsZXQgcmV0ID0gMDtcbiAgICBmb3IgKGxldCBpID0gY1N0YXJ0OyBpIDw9IGNFbmQ7IGkrKykge1xuICAgICAgcmV0ID0gcmV0ICsgdGhpcy5nZXRDb2x1bW5XaWR0aChpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfVxuXG4gIGdldFNpZGVTdGFydEFuZEVuZENvbHVtbkluZGV4KHNpZGVJZGVudDogU2lkZUlkZW50KTogW251bWJlciwgbnVtYmVyXSB7XG4gICAgY29uc3QgYzEgPSB0aGlzLmdldEZpeGVkTGVmdENvbHVtbkNvdW50KCk7XG4gICAgY29uc3QgYzIgPSB0aGlzLmdldEZpeGVkUmlnaHRDb2x1bW5Db3VudCgpO1xuXG4gICAgbGV0IGNTdGFydCA9IDA7XG4gICAgbGV0IGNFbmQgPSB0aGlzLmNvbHVtbkNvdW50IC0gMTtcbiAgICBpZiAoc2lkZUlkZW50ID09PSBcIndlc3RcIikge1xuICAgICAgY0VuZCA9IGMxIC0gMTtcbiAgICB9IGVsc2UgaWYgKHNpZGVJZGVudCA9PT0gXCJlYXN0XCIpIHtcbiAgICAgIGNTdGFydCA9IHRoaXMuY29sdW1uQ291bnQgLSBjMjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gY2VudGVyOlxuICAgICAgY1N0YXJ0ID0gYzE7XG4gICAgICBjRW5kID0gdGhpcy5jb2x1bW5Db3VudCAtIGMyIC0gMTtcbiAgICB9XG4gICAgcmV0dXJuIFtjU3RhcnQsIGNFbmRdO1xuICB9XG5cbiAgZ2V0Q29sdW1uRGVmKGluZGV4OiBudW1iZXIpOiBDb2x1bW5EZWZJZiB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKGluZGV4IDwgdGhpcy5jb2x1bW5EZWZzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29sdW1uRGVmc1tpbmRleF07XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRGaXhlZExlZnRDb2x1bW5Db3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmZpeGVkTGVmdENvbHVtbkNvdW50O1xuICB9XG5cbiAgZ2V0Rml4ZWRSaWdodENvbHVtbkNvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZml4ZWRSaWdodENvbHVtbkNvdW50O1xuICB9XG5cbiAgZ2V0QXJlYU1vZGVsKGFyZWE6IEFyZWFJZGVudCk6IEFyZWFNb2RlbElmIHtcbiAgICBpZiAoYXJlYSA9PT0gXCJoZWFkZXJcIikge1xuICAgICAgcmV0dXJuIHRoaXMuaGVhZGVyQXJlYU1vZGVsO1xuICAgIH1cbiAgICBpZiAoYXJlYSA9PT0gXCJib2R5XCIpIHtcbiAgICAgIHJldHVybiB0aGlzLmJvZHlBcmVhTW9kZWw7XG4gICAgfVxuICAgIGlmIChhcmVhID09PSBcImZvb3RlclwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5mb290ZXJBcmVhTW9kZWw7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIldyb25nIGlkZW50LlwiKTtcbiAgfVxuXG4gIGdldEJvZHlNb2RlbCgpOiBBcmVhTW9kZWxJZiB7XG4gICAgcmV0dXJuIHRoaXMuYm9keUFyZWFNb2RlbDtcbiAgfVxuXG4gIGlzRm9vdGVyVmlzaWJlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAodGhpcy5mb290ZXJBcmVhTW9kZWw/LmdldFJvd0NvdW50KCkgPz8gMCkgPiAwO1xuICB9XG5cbiAgaXNIZWFkZXJWaXNpYmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLmhlYWRlckFyZWFNb2RlbD8uZ2V0Um93Q291bnQoKSA/PyAwKSA+IDA7XG4gIH1cblxuICBpc1Jvd0NoZWNrYm94VmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5yb3dDaGVja2JveFZpc2libGU7XG4gIH1cblxuICBleHRlcm5hbEZpbHRlckNoYW5nZWQ8VD4ocHJlZGljdEZuOiBGaWx0ZXJGdW5jdGlvbjxUPik6IHZvaWQge1xuICAgIHRoaXMuZ2V0QXJlYU1vZGVsKFwiYm9keVwiKS5leHRlcm5hbEZpbHRlckNoYW5nZWQocHJlZGljdEZuKTtcbiAgfVxuXG4gIGRvU29ydChzb3J0SXRlbXM6IFNvcnRJdGVtW10pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBcmVhTW9kZWwoXCJib2R5XCIpLmRvU29ydChzb3J0SXRlbXMpO1xuICB9XG5cbiAgZ2V0Q29sdW1uRGVmcygpOiBDb2x1bW5EZWZJZltdIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5EZWZzO1xuICB9XG5cbiAgZ2V0Q29sdW1uUHJvcGVydHkoY29sdW1uSW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29sdW1uRGVmc1tjb2x1bW5JbmRleF0ucHJvcGVydHk7XG4gIH1cblxuICBnZXRCb2R5Um93QnlJbmRleChyb3dJbmRleDogbnVtYmVyKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5nZXRCb2R5TW9kZWwoKS5nZXRSb3dCeUluZGV4KHJvd0luZGV4KTtcbiAgfVxuXG4gIGlzU29ydGFibGUoY29sdW1uSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmNvbHVtbkRlZnNcbiAgICAgICYmIGNvbHVtbkluZGV4IDwgdGhpcy5jb2x1bW5EZWZzLmxlbmd0aFxuICAgICAgJiYgdGhpcy5jb2x1bW5EZWZzW2NvbHVtbkluZGV4XS5zb3J0YWJsZSkge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHRoaXMuY29sdW1uRGVmc1tjb2x1bW5JbmRleF0uc29ydGFibGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY2hhbmdlQ29sdW1uT3JkZXIoc291cmNlQ29sdW1uSW5kZXg6IG51bWJlciwgdGFyZ2V0Q29sdW1uSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuYXJyYXlNb3ZlKHRoaXMuY29sdW1uRGVmcywgc291cmNlQ29sdW1uSW5kZXgsIHRhcmdldENvbHVtbkluZGV4KTtcbiAgICB0aGlzLmFycmF5TW92ZSh0aGlzLmNvbHVtblNpemVzLCBzb3VyY2VDb2x1bW5JbmRleCwgdGFyZ2V0Q29sdW1uSW5kZXgpO1xuICAgIHRoaXMuaGVhZGVyQXJlYU1vZGVsPy5jaGFuZ2VDb2x1bW5PcmRlcihzb3VyY2VDb2x1bW5JbmRleCwgdGFyZ2V0Q29sdW1uSW5kZXgpO1xuICAgIHRoaXMuYm9keUFyZWFNb2RlbD8uY2hhbmdlQ29sdW1uT3JkZXIoc291cmNlQ29sdW1uSW5kZXgsIHRhcmdldENvbHVtbkluZGV4KTtcbiAgICB0aGlzLmZvb3RlckFyZWFNb2RlbD8uY2hhbmdlQ29sdW1uT3JkZXIoc291cmNlQ29sdW1uSW5kZXgsIHRhcmdldENvbHVtbkluZGV4KTtcbiAgICB0aGlzLmNhbGNYUG9zaXRpb25zKCk7XG4gIH1cblxuXG4gIHByaXZhdGUgcmVjYWxjQ29sdW1uV2lkdGhlcyhjbGllbnRXaWR0aDogbnVtYmVyKSB7XG4gICAgaWYgKCF0aGlzLmNvbHVtbkRlZnM/Lmxlbmd0aCAmJiAhdGhpcy5jb2x1bW5TaXplcz8ubGVuZ3RoKSB7XG4gICAgICB0aGlzLmNvbHVtblNpemVzID0gbmV3IEFycmF5KHRoaXMuZ2V0Q29sdW1uQ291bnQoKSkuZmlsbCh0aGlzLm92ZXJyaWRpbmdDb2x1bW5XaWR0aCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbHVtbkRlZnM/Lmxlbmd0aCkge1xuICAgICAgdGhpcy5jb2x1bW5TaXplcyA9IHRoaXMuY29sdW1uRGVmcy5tYXAoZGVmID0+IHtcbiAgICAgICAgaWYgKGRlZi53aWR0aC51bml0ID09PSBcIiVcIiAmJiBjbGllbnRXaWR0aCkge1xuICAgICAgICAgIC8vIG9ubHkgZm9yIGEgJSB2YWx1ZSB3ZSBoYXZlIHRvIGNoZWNrIG1pbiBhbmQgbWF4OlxuICAgICAgICAgIGxldCBweCA9IE1hdGguZmxvb3IoZGVmLndpZHRoLnZhbHVlICogY2xpZW50V2lkdGggLyAxMDApO1xuICAgICAgICAgIGlmIChkZWYubWluV2lkdGgpIHtcbiAgICAgICAgICAgIGxldCBweE1pbiA9IGRlZi5taW5XaWR0aC51bml0ID09PSBcInB4XCIgPyBkZWYubWluV2lkdGgudmFsdWUgOiBNYXRoLmZsb29yKGRlZi5taW5XaWR0aC52YWx1ZSAqIGNsaWVudFdpZHRoIC8gMTAwKTtcbiAgICAgICAgICAgIHB4ID0gTWF0aC5tYXgocHhNaW4sIHB4KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRlZi5tYXhXaWR0aCkge1xuICAgICAgICAgICAgbGV0IHB4TWF4ID0gZGVmLm1heFdpZHRoLnVuaXQgPT09IFwicHhcIiA/IGRlZi5tYXhXaWR0aC52YWx1ZSA6IE1hdGguZmxvb3IoZGVmLm1heFdpZHRoLnZhbHVlICogY2xpZW50V2lkdGggLyAxMDApO1xuICAgICAgICAgICAgcHggPSBNYXRoLm1pbihweE1heCwgcHgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcHg7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZi53aWR0aC52YWx1ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXJyYXlNb3ZlKGFycjogYW55W10sIGZyb21JbmRleDogbnVtYmVyLCB0b0luZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gYXJyLnNwbGljZShmcm9tSW5kZXgsIDEpWzBdO1xuICAgIGFyci5zcGxpY2UodG9JbmRleCwgMCwgZWxlbWVudCk7XG4gICAgcmV0dXJuIGFycjtcbiAgfVxuXG4gIHByaXZhdGUgcmVjYWxjQ29udGVudFdpZHRoSW5QeCgpIHtcbiAgICB0aGlzLmNvbnRlbnRXaWR0aEluUHggPSB0aGlzLmdldFNpZGVBcmVhV2lkdGgoXCJjZW50ZXJcIik7XG4gIH1cblxuICBwcml2YXRlIGNhbGNYUG9zaXRpb25zKCkge1xuICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gdGhpcy5nZXRDb2x1bW5Db3VudCgpO1xuICAgIHRoaXMueFBvc2l0aW9ucyA9IG5ldyBBcnJheShjb2x1bW5Db3VudCArIDEpO1xuICAgIHRoaXMueFBvc2l0aW9uc1swXSA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW5Db3VudDsgaSsrKSB7XG4gICAgICB0aGlzLnhQb3NpdGlvbnNbaSArIDFdID0gdGhpcy5nZXRDb2x1bW5XaWR0aChpKSArIHRoaXMueFBvc2l0aW9uc1tpXTtcbiAgICB9XG4gIH1cblxuXG59XG5cblxuIl19