import { AbstractAreaModel } from "./abstract-area-model";
import { TreeRow } from "../../common/tree-row";
import { SorterService } from "../../../service/sorter.service";
export class AreaModelObjectyArray extends AbstractAreaModel {
    areaIdent;
    rows;
    defaultRowHeight;
    columnDefs;
    properties;
    filteredRows;
    sorterService = new SorterService();
    constructor(areaIdent, rows, defaultRowHeight, columnDefs = []) {
        super(areaIdent, columnDefs, defaultRowHeight);
        this.areaIdent = areaIdent;
        this.rows = rows;
        this.defaultRowHeight = defaultRowHeight;
        this.columnDefs = columnDefs;
        this.filteredRows = [...rows];
        this.properties = columnDefs.map(def => def.property);
    }
    getRowCount() {
        return this.filteredRows?.length ?? 0;
    }
    getValueAt(rowIndex, columnIndex) {
        const property = this.properties[columnIndex];
        let t = this.filteredRows[rowIndex];
        if (t instanceof TreeRow) {
            t = t.data;
        }
        if (t) {
            return this.getValueByT(t, property);
        }
        return "";
    }
    getFilteredRows() {
        return this.filteredRows;
    }
    getAllRows() {
        return this.rows;
    }
    getRowHeight(_rowIndex) {
        return this.defaultRowHeight;
    }
    getRowByIndex(rowIndex) {
        return this.filteredRows[rowIndex];
    }
    externalFilterChanged(predictFn) {
        this.filteredRows = (this.rows ? this.rows.filter(predictFn) : []);
    }
    doSort(sortItems) {
        for (const sortItem of sortItems) {
            const { columnIndex, sortState } = sortItem;
            const f = sortState === "asc" ? 1 :
                sortState === "desc" ? -1 : 0;
            const property = this.properties[columnIndex];
            this.filteredRows = this.filteredRows.sort(this.genericFlatTableSortComparator(property, f));
        }
        return true;
    }
    getValueByT(t, property) {
        if (property.includes(".")) {
            return this.getPropertyValue(t, property.split("."));
        }
        // @ts-ignore
        return t[property];
    }
    changeColumnOrder(sourceColumnIndex, targetColumnIndex) {
        this.arrayMove(this.properties, sourceColumnIndex, targetColumnIndex);
        super.changeColumnOrder(sourceColumnIndex, targetColumnIndex);
    }
    genericFlatTableSortComparator(property, f) {
        return (a, b) => {
            const va = this.getValueByT(a, property);
            const vb = this.getValueByT(b, property);
            return this.sorterService.genericSortComparator(va, vb, f);
        };
    }
    getPropertyValue(o, props) {
        const prop = props.shift();
        // @ts-ignore
        let o2 = o[prop];
        if (o2 && props.length) {
            return this.getPropertyValue(o2, props);
        }
        return o2;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJlYS1tb2RlbC1vYmplY3QtYXJyYXkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3RhYmxlL3NyYy9saWIvdGFibGUvZGF0YS90YWJsZW1vZGVsL2FyZWFtb2RlbC9hcmVhLW1vZGVsLW9iamVjdC1hcnJheS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFJaEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBR2hFLE1BQU0sT0FBTyxxQkFBeUIsU0FBUSxpQkFBb0I7SUFPOUM7SUFDRztJQUNIO0lBQ0c7SUFSRixVQUFVLENBQVc7SUFDOUIsWUFBWSxDQUFNO0lBQ2xCLGFBQWEsR0FBa0IsSUFBSSxhQUFhLEVBQUUsQ0FBQztJQUU3RCxZQUNrQixTQUFvQixFQUNqQixJQUFTLEVBQ1osZ0JBQXdCLEVBQ3JCLGFBQTRCLEVBQUU7UUFFakQsS0FBSyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUwvQixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ2pCLFNBQUksR0FBSixJQUFJLENBQUs7UUFDWixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQVE7UUFDckIsZUFBVSxHQUFWLFVBQVUsQ0FBb0I7UUFHakQsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxXQUFXO1FBQ1QsT0FBTyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sSUFBSSxDQUFDLENBQUM7SUFDeEMs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LE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQztJQUNKLENBQUM7SUFHTyxnQkFBZ0IsQ0FBQyxDQUFNLEVBQUUsS0FBZTtRQUM5QyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDM0IsYUFBYTtRQUNiLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQixJQUFJLEVBQUUsSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ3RCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUN6QztRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RBcmVhTW9kZWwgfSBmcm9tIFwiLi9hYnN0cmFjdC1hcmVhLW1vZGVsXCI7XG5pbXBvcnQgeyBUcmVlUm93IH0gZnJvbSBcIi4uLy4uL2NvbW1vbi90cmVlLXJvd1wiO1xuaW1wb3J0IHsgQ29sdW1uRGVmSWYgfSBmcm9tIFwiLi4vY29sdW1uL2NvbHVtbi1kZWYuaWZcIjtcbmltcG9ydCB7IEFyZWFJZGVudCB9IGZyb20gXCIuLi9hcmVhLWlkZW50LnR5cGVcIjtcbmltcG9ydCB7IEZpbHRlckZ1bmN0aW9uIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9maWx0ZXItZnVuY3Rpb25cIjtcbmltcG9ydCB7IFNvcnRlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vLi4vc2VydmljZS9zb3J0ZXIuc2VydmljZVwiO1xuaW1wb3J0IHsgU29ydEl0ZW0gfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NvcnQtaXRlbVwiO1xuXG5leHBvcnQgY2xhc3MgQXJlYU1vZGVsT2JqZWN0eUFycmF5PFQ+IGV4dGVuZHMgQWJzdHJhY3RBcmVhTW9kZWw8VD4ge1xuXG4gIHByb3RlY3RlZCByZWFkb25seSBwcm9wZXJ0aWVzOiBzdHJpbmdbXTtcbiAgcHJvdGVjdGVkIGZpbHRlcmVkUm93czogVFtdO1xuICBwcm90ZWN0ZWQgc29ydGVyU2VydmljZTogU29ydGVyU2VydmljZSA9IG5ldyBTb3J0ZXJTZXJ2aWNlKCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIG92ZXJyaWRlIGFyZWFJZGVudDogQXJlYUlkZW50LFxuICAgIHByb3RlY3RlZCByZWFkb25seSByb3dzOiBUW10sXG4gICAgcHVibGljIG92ZXJyaWRlIGRlZmF1bHRSb3dIZWlnaHQ6IG51bWJlcixcbiAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgY29sdW1uRGVmczogQ29sdW1uRGVmSWZbXSA9IFtdXG4gICkge1xuICAgIHN1cGVyKGFyZWFJZGVudCwgY29sdW1uRGVmcywgZGVmYXVsdFJvd0hlaWdodCk7XG4gICAgdGhpcy5maWx0ZXJlZFJvd3MgPSBbLi4ucm93c107XG4gICAgdGhpcy5wcm9wZXJ0aWVzID0gY29sdW1uRGVmcy5tYXAoZGVmID0+IGRlZi5wcm9wZXJ0eSk7XG4gIH1cblxuICBnZXRSb3dDb3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcmVkUm93cz8ubGVuZ3RoID8/IDA7XG4gIH1cblxuICBnZXRWYWx1ZUF0KHJvd0luZGV4OiBudW1iZXIsIGNvbHVtbkluZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIGNvbnN0IHByb3BlcnR5ID0gdGhpcy5wcm9wZXJ0aWVzW2NvbHVtbkluZGV4XTtcbiAgICBsZXQgdCA9IHRoaXMuZmlsdGVyZWRSb3dzW3Jvd0luZGV4XTtcbiAgICBpZiAodCBpbnN0YW5jZW9mIFRyZWVSb3cpIHtcbiAgICAgIHQgPSB0LmRhdGE7XG4gICAgfVxuICAgIGlmICh0KSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZUJ5VCh0LCBwcm9wZXJ0eSk7XG4gICAgfVxuICAgIHJldHVybiBcIlwiO1xuICB9XG5cbiAgZ2V0RmlsdGVyZWRSb3dzKCk6IFRbXSB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyZWRSb3dzO1xuICB9XG5cbiAgZ2V0QWxsUm93cygpOiBUW10ge1xuICAgIHJldHVybiB0aGlzLnJvd3M7XG4gIH1cblxuICBnZXRSb3dIZWlnaHQoX3Jvd0luZGV4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRlZmF1bHRSb3dIZWlnaHQ7XG4gIH1cblxuICBvdmVycmlkZSBnZXRSb3dCeUluZGV4KHJvd0luZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlcmVkUm93c1tyb3dJbmRleF07XG4gIH1cblxuICBleHRlcm5hbEZpbHRlckNoYW5nZWQocHJlZGljdEZuOiBGaWx0ZXJGdW5jdGlvbjxhbnk+KTogdm9pZCB7XG4gICAgdGhpcy5maWx0ZXJlZFJvd3MgPSAodGhpcy5yb3dzID8gdGhpcy5yb3dzLmZpbHRlcihwcmVkaWN0Rm4pIDogW10pO1xuICB9XG5cbiAgb3ZlcnJpZGUgZG9Tb3J0KHNvcnRJdGVtczogU29ydEl0ZW1bXSk6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3Qgc29ydEl0ZW0gb2Ygc29ydEl0ZW1zKSB7XG4gICAgICBjb25zdCB7IGNvbHVtbkluZGV4LCBzb3J0U3RhdGUgfSA9IHNvcnRJdGVtO1xuICAgICAgY29uc3QgZiA9IHNvcnRTdGF0ZSA9PT0gXCJhc2NcIiA/IDEgOlxuICAgICAgICBzb3J0U3RhdGUgPT09IFwiZGVzY1wiID8gLTEgOiAwO1xuICAgICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXNbY29sdW1uSW5kZXhdO1xuICAgICAgdGhpcy5maWx0ZXJlZFJvd3MgPSB0aGlzLmZpbHRlcmVkUm93cy5zb3J0KHRoaXMuZ2VuZXJpY0ZsYXRUYWJsZVNvcnRDb21wYXJhdG9yKHByb3BlcnR5LCBmKSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZ2V0VmFsdWVCeVQodDogVCwgcHJvcGVydHk6IHN0cmluZykge1xuICAgIGlmIChwcm9wZXJ0eS5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFByb3BlcnR5VmFsdWUodCwgcHJvcGVydHkuc3BsaXQoXCIuXCIpKTtcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiB0W3Byb3BlcnR5XTtcbiAgfVxuXG4gIG92ZXJyaWRlIGNoYW5nZUNvbHVtbk9yZGVyKHNvdXJjZUNvbHVtbkluZGV4OiBudW1iZXIsIHRhcmdldENvbHVtbkluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmFycmF5TW92ZSh0aGlzLnByb3BlcnRpZXMsIHNvdXJjZUNvbHVtbkluZGV4LCB0YXJnZXRDb2x1bW5JbmRleCk7XG4gICAgc3VwZXIuY2hhbmdlQ29sdW1uT3JkZXIoc291cmNlQ29sdW1uSW5kZXgsIHRhcmdldENvbHVtbkluZGV4KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZW5lcmljRmxhdFRhYmxlU29ydENvbXBhcmF0b3IocHJvcGVydHk6IHN0cmluZywgZjogbnVtYmVyKSB7XG4gICAgcmV0dXJuIChhOiBULCBiOiBUKSA9PiB7XG4gICAgICBjb25zdCB2YSA9IHRoaXMuZ2V0VmFsdWVCeVQoYSwgcHJvcGVydHkpO1xuICAgICAgY29uc3QgdmIgPSB0aGlzLmdldFZhbHVlQnlUKGIsIHByb3BlcnR5KTtcbiAgICAgIHJldHVybiB0aGlzLnNvcnRlclNlcnZpY2UuZ2VuZXJpY1NvcnRDb21wYXJhdG9yKHZhLCB2YiwgZik7XG4gICAgfTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBnZXRQcm9wZXJ0eVZhbHVlKG86IGFueSwgcHJvcHM6IHN0cmluZ1tdKTogYW55IHtcbiAgICBjb25zdCBwcm9wID0gcHJvcHMuc2hpZnQoKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgbGV0IG8yID0gb1twcm9wXTtcbiAgICBpZiAobzIgJiYgcHJvcHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRQcm9wZXJ0eVZhbHVlKG8yLCBwcm9wcyk7XG4gICAgfVxuICAgIHJldHVybiBvMjtcbiAgfVxufVxuXG4iXX0=