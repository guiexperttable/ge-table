export class AbstractAreaModel {
    areaIdent;
    columnDefs;
    defaultRowHeight;
    rowSelectionModel = undefined;
    cellRenderers;
    yPositions = [];
    constructor(areaIdent, columnDefs = [], defaultRowHeight = -1) {
        this.areaIdent = areaIdent;
        this.columnDefs = columnDefs;
        this.defaultRowHeight = defaultRowHeight;
        this.cellRenderers = columnDefs.map(def => def.rendererMap[areaIdent]);
    }
    getTooltipAt(_rowIndex, _columnIndex) {
        return "";
    }
    ;
    getCellRenderer(_rowIndex, columnIndex) {
        if (columnIndex < this.cellRenderers.length) {
            return this.cellRenderers[columnIndex];
        }
        return undefined;
    }
    getColspanAt(_rowIndex, _columnIndex) {
        return 0;
    }
    getCustomClassesAt(_rowIndex, _columnIndex) {
        return [];
    }
    getCustomStyleAt(_rowIndex, _columnIndex) {
        return undefined;
    }
    getRowspanAt(_rowIndex, _columnIndex) {
        return 0;
    }
    getRowByIndex(_rowIndex) {
        return undefined;
    }
    isRowCheckable(_rowIndex) {
        return true;
    }
    isRowChecked(rowIndex) {
        const row = this.getRowByIndex(rowIndex);
        return this.rowSelectionModel?.isRowChecked(row);
    }
    setRowChecked(rowIndex, checked) {
        if (this.rowSelectionModel) {
            const row = this.getRowByIndex(rowIndex);
            this.rowSelectionModel.checkRow(row, checked);
        }
    }
    getMaxColspan() {
        return 31;
    }
    getMaxRowspan() {
        return 31;
    }
    getYPosByRowIndex(rowIndex) {
        if (this.defaultRowHeight > 0) {
            return this.defaultRowHeight * rowIndex;
        }
        return this.yPositions[rowIndex];
    }
    init() {
        if (!this.yPositions.length && this.getRowCount() !== undefined) {
            if (this.defaultRowHeight === -1) {
                this.calcYPositions();
            }
        }
    }
    isFilterable() {
        return this.areaIdent === "body";
    }
    doSort(_sortItems) {
        // do nothing
        return false;
    }
    isEditable(_rowIndex, columnIndex) {
        if (this.columnDefs
            && columnIndex < this.columnDefs.length
            && this.columnDefs[columnIndex].editable) {
            // @ts-ignore
            return this.columnDefs[columnIndex].editable();
        }
        return false;
    }
    setValue(rowIndex, columnIndex, value) {
        const editInputPipe = this.columnDefs[columnIndex]?.editInputPipe;
        if (editInputPipe) {
            value = editInputPipe(value, rowIndex, columnIndex);
        }
        const row = this.getRowByIndex(rowIndex);
        const property = this.columnDefs[columnIndex].property;
        if (property.includes(".")) {
            return this.setPropertyValue(row, property.split("."), value);
        }
        // @ts-ignore
        row[property] = value;
        return true;
    }
    isSelectable(_rowIndex, _columnIndex) {
        return true;
    }
    changeColumnOrder(sourceColumnIndex, targetColumnIndex) {
        //  not this! this.arrayMove(this.columnDefs...)
        this.arrayMove(this.cellRenderers, sourceColumnIndex, targetColumnIndex);
    }
    setPropertyValue(o, props, value) {
        const prop = props.shift();
        if (prop) {
            // @ts-ignore
            let o2 = o[prop];
            if (o2 && props.length) {
                return this.setPropertyValue(o2, props, value);
            }
            else {
                o[prop] = value;
                return true;
            }
        }
        return false;
    }
    arrayMove(arr, fromIndex, toIndex) {
        const element = arr.splice(fromIndex, 1)[0];
        arr.splice(toIndex, 0, element);
        return arr;
    }
    calcYPositions() {
        const rowCount = this.getRowCount();
        this.yPositions = new Array(rowCount + 1);
        this.yPositions[0] = 0;
        for (let i = 0; i < rowCount; i++) {
            this.yPositions[i + 1] = this.getRowHeight(i) + this.yPositions[i];
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtYXJlYS1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvdGFibGUvc3JjL2xpYi90YWJsZS9kYXRhL3RhYmxlbW9kZWwvYXJlYW1vZGVsL2Fic3RyYWN0LWFyZWEtbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBV0EsTUFBTSxPQUFnQixpQkFBaUI7SUFPNUI7SUFDRztJQUNIO0lBUEYsaUJBQWlCLEdBQXFDLFNBQVMsQ0FBQztJQUM3RCxhQUFhLENBQWlDO0lBQzlDLFVBQVUsR0FBYSxFQUFFLENBQUM7SUFFcEMsWUFDUyxTQUFvQixFQUNqQixhQUE0QixFQUFFLEVBQ2pDLG1CQUEyQixDQUFDLENBQUM7UUFGN0IsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNqQixlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUNqQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWE7UUFFcEMsSUFBSSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFPRCxZQUFZLENBQUMsU0FBaUIsRUFBRSxZQUFvQjtRQUNsRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFBQSxDQUFDO0lBSUYsZUFBZSxDQUFDLFNBQWlCLEVBQUUsV0FBbUI7UUFDcEQsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUU7WUFDM0MsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELFlBQVksQ0FBQyxTQUFpQixFQUFFLFlBQW9CO1FBQ2xELE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVELGtCQUFrQixDQUFDLFNBQWlCLEVBQUUsWUFB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QUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDaEMsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRU8sY0FBYztRQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEtBQUssQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEU7SUFDSCxDQUFDO0NBRUYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZWxsUmVuZGVyZXJJZiB9IGZyb20gXCIuLi8uLi8uLi9yZW5kZXJlci9jZWxsLXJlbmRlci5pZlwiO1xuaW1wb3J0IHsgQXJlYU1vZGVsSWYgfSBmcm9tIFwiLi9hcmVhLW1vZGVsLmlmXCI7XG5pbXBvcnQgeyBDaGVja2VkVHlwZSB9IGZyb20gXCIuLi8uLi9jb21tb24vY2hlY2tlZC10eXBlXCI7XG5pbXBvcnQgeyBDb2x1bW5EZWZJZiB9IGZyb20gXCIuLi9jb2x1bW4vY29sdW1uLWRlZi5pZlwiO1xuaW1wb3J0IHsgQXJlYUlkZW50IH0gZnJvbSBcIi4uL2FyZWEtaWRlbnQudHlwZVwiO1xuaW1wb3J0IHsgQ2hlY2tib3hNb2RlbElmIH0gZnJvbSBcIi4uLy4uLy4uL2NoZWNrYm94L2NoZWNrYm94LW1vZGVsLmlmXCI7XG5pbXBvcnQgeyBGaWx0ZXJGdW5jdGlvbiB9IGZyb20gXCIuLi8uLi9jb21tb24vZmlsdGVyLWZ1bmN0aW9uXCI7XG5pbXBvcnQgeyBTb3J0SXRlbSB9IGZyb20gXCIuLi8uLi9jb21tb24vc29ydC1pdGVtXCI7XG5pbXBvcnQgeyBIYXNEZWZhdWx0Um93SGVpZ2h0SWYgfSBmcm9tIFwiLi9oYXMtZGVmYXVsdC1yb3ctaGVpZ2h0LWlmXCI7XG5cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0QXJlYU1vZGVsPFQ+IGltcGxlbWVudHMgQXJlYU1vZGVsSWYsIEhhc0RlZmF1bHRSb3dIZWlnaHRJZiB7XG5cbiAgcHVibGljIHJvd1NlbGVjdGlvbk1vZGVsOiBDaGVja2JveE1vZGVsSWY8YW55PiB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgcHJvdGVjdGVkIGNlbGxSZW5kZXJlcnM6IChDZWxsUmVuZGVyZXJJZiB8IHVuZGVmaW5lZClbXTtcbiAgcHJvdGVjdGVkIHlQb3NpdGlvbnM6IG51bWJlcltdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGFyZWFJZGVudDogQXJlYUlkZW50LFxuICAgIHByb3RlY3RlZCBjb2x1bW5EZWZzOiBDb2x1bW5EZWZJZltdID0gW10sXG4gICAgcHVibGljIGRlZmF1bHRSb3dIZWlnaHQ6IG51bWJlciA9IC0xXG4gICkge1xuICAgIHRoaXMuY2VsbFJlbmRlcmVycyA9IGNvbHVtbkRlZnMubWFwKGRlZiA9PiBkZWYucmVuZGVyZXJNYXBbYXJlYUlkZW50XSk7XG4gIH1cblxuXG4gIGFic3RyYWN0IGdldFJvd0NvdW50KCk6IG51bWJlcjtcblxuICBhYnN0cmFjdCBnZXRWYWx1ZUF0KHJvd0luZGV4OiBudW1iZXIsIGNvbHVtbkluZGV4OiBudW1iZXIpOiBhbnk7XG5cbiAgZ2V0VG9vbHRpcEF0KF9yb3dJbmRleDogbnVtYmVyLCBfY29sdW1uSW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH07XG5cbiAgYWJzdHJhY3QgZ2V0Um93SGVpZ2h0KHJvd0luZGV4OiBudW1iZXIpOiBudW1iZXI7XG5cbiAgZ2V0Q2VsbFJlbmRlcmVyKF9yb3dJbmRleDogbnVtYmVyLCBjb2x1bW5JbmRleDogbnVtYmVyKTogQ2VsbFJlbmRlcmVySWYgfCB1bmRlZmluZWQge1xuICAgIGlmIChjb2x1bW5JbmRleCA8IHRoaXMuY2VsbFJlbmRlcmVycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNlbGxSZW5kZXJlcnNbY29sdW1uSW5kZXhdO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0Q29sc3BhbkF0KF9yb3dJbmRleDogbnVtYmVyLCBfY29sdW1uSW5kZXg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBnZXRDdXN0b21DbGFzc2VzQXQoX3Jvd0luZGV4OiBudW1iZXIsIF9jb2x1bW5JbmRleDogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIGdldEN1c3RvbVN0eWxlQXQoX3Jvd0luZGV4OiBudW1iZXIsIF9jb2x1bW5JbmRleDogbnVtYmVyKTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldFJvd3NwYW5BdChfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgZ2V0Um93QnlJbmRleChfcm93SW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlzUm93Q2hlY2thYmxlKF9yb3dJbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpc1Jvd0NoZWNrZWQocm93SW5kZXg6IG51bWJlcik6IENoZWNrZWRUeXBlIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCByb3cgPSB0aGlzLmdldFJvd0J5SW5kZXgocm93SW5kZXgpO1xuICAgIHJldHVybiB0aGlzLnJvd1NlbGVjdGlvbk1vZGVsPy5pc1Jvd0NoZWNrZWQocm93KTtcbiAgfVxuXG4gIHNldFJvd0NoZWNrZWQocm93SW5kZXg6IG51bWJlciwgY2hlY2tlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh0aGlzLnJvd1NlbGVjdGlvbk1vZGVsKSB7XG4gICAgICBjb25zdCByb3cgPSB0aGlzLmdldFJvd0J5SW5kZXgocm93SW5kZXgpO1xuICAgICAgdGhpcy5yb3dTZWxlY3Rpb25Nb2RlbC5jaGVja1Jvdyhyb3csIGNoZWNrZWQpO1xuICAgIH1cbiAgfVxuXG4gIGdldE1heENvbHNwYW4oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gMzE7XG4gIH1cblxuICBnZXRNYXhSb3dzcGFuKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDMxO1xuICB9XG5cblxuICBnZXRZUG9zQnlSb3dJbmRleChyb3dJbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAodGhpcy5kZWZhdWx0Um93SGVpZ2h0ID4gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFJvd0hlaWdodCAqIHJvd0luZGV4O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy55UG9zaXRpb25zW3Jvd0luZGV4XTtcbiAgfVxuXG5cbiAgaW5pdCgpIHtcbiAgICBpZiAoIXRoaXMueVBvc2l0aW9ucy5sZW5ndGggJiYgdGhpcy5nZXRSb3dDb3VudCgpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICh0aGlzLmRlZmF1bHRSb3dIZWlnaHQgPT09IC0xKSB7XG4gICAgICAgIHRoaXMuY2FsY1lQb3NpdGlvbnMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhYnN0cmFjdCBleHRlcm5hbEZpbHRlckNoYW5nZWQ8VD4ocHJlZGljdEZuOiBGaWx0ZXJGdW5jdGlvbjxUPik6IHZvaWQgO1xuXG4gIGlzRmlsdGVyYWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5hcmVhSWRlbnQgPT09IFwiYm9keVwiO1xuICB9XG5cbiAgZG9Tb3J0KF9zb3J0SXRlbXM6IFNvcnRJdGVtW10pOiBib29sZWFuIHtcbiAgICAvLyBkbyBub3RoaW5nXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaXNFZGl0YWJsZShfcm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmNvbHVtbkRlZnNcbiAgICAgICYmIGNvbHVtbkluZGV4IDwgdGhpcy5jb2x1bW5EZWZzLmxlbmd0aFxuICAgICAgJiYgdGhpcy5jb2x1bW5EZWZzW2NvbHVtbkluZGV4XS5lZGl0YWJsZSkge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHRoaXMuY29sdW1uRGVmc1tjb2x1bW5JbmRleF0uZWRpdGFibGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgc2V0VmFsdWUocm93SW5kZXg6IG51bWJlciwgY29sdW1uSW5kZXg6IG51bWJlciwgdmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVkaXRJbnB1dFBpcGUgPSB0aGlzLmNvbHVtbkRlZnNbY29sdW1uSW5kZXhdPy5lZGl0SW5wdXRQaXBlO1xuICAgIGlmIChlZGl0SW5wdXRQaXBlKSB7XG4gICAgICB2YWx1ZSA9IGVkaXRJbnB1dFBpcGUodmFsdWUsIHJvd0luZGV4LCBjb2x1bW5JbmRleCk7XG4gICAgfVxuICAgIGNvbnN0IHJvdzogVCA9IHRoaXMuZ2V0Um93QnlJbmRleChyb3dJbmRleCk7XG4gICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLmNvbHVtbkRlZnNbY29sdW1uSW5kZXhdLnByb3BlcnR5O1xuICAgIGlmIChwcm9wZXJ0eS5pbmNsdWRlcyhcIi5cIikpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldFByb3BlcnR5VmFsdWUocm93LCBwcm9wZXJ0eS5zcGxpdChcIi5cIiksIHZhbHVlKTtcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJvd1twcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlzU2VsZWN0YWJsZShfcm93SW5kZXg6IG51bWJlciwgX2NvbHVtbkluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNoYW5nZUNvbHVtbk9yZGVyKHNvdXJjZUNvbHVtbkluZGV4OiBudW1iZXIsIHRhcmdldENvbHVtbkluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAvLyAgbm90IHRoaXMhIHRoaXMuYXJyYXlNb3ZlKHRoaXMuY29sdW1uRGVmcy4uLilcbiAgICB0aGlzLmFycmF5TW92ZSh0aGlzLmNlbGxSZW5kZXJlcnMsIHNvdXJjZUNvbHVtbkluZGV4LCB0YXJnZXRDb2x1bW5JbmRleCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0UHJvcGVydHlWYWx1ZShvOiBhbnksIHByb3BzOiBzdHJpbmdbXSwgdmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHByb3AgPSBwcm9wcy5zaGlmdCgpO1xuICAgIGlmIChwcm9wKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBsZXQgbzIgPSBvW3Byb3BdO1xuICAgICAgaWYgKG8yICYmIHByb3BzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXRQcm9wZXJ0eVZhbHVlKG8yLCBwcm9wcywgdmFsdWUpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvW3Byb3BdID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcm90ZWN0ZWQgYXJyYXlNb3ZlKGFycjogYW55W10sIGZyb21JbmRleDogbnVtYmVyLCB0b0luZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gYXJyLnNwbGljZShmcm9tSW5kZXgsIDEpWzBdO1xuICAgIGFyci5zcGxpY2UodG9JbmRleCwgMCwgZWxlbWVudCk7XG4gICAgcmV0dXJuIGFycjtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY1lQb3NpdGlvbnMoKSB7XG4gICAgY29uc3Qgcm93Q291bnQgPSB0aGlzLmdldFJvd0NvdW50KCk7XG4gICAgdGhpcy55UG9zaXRpb25zID0gbmV3IEFycmF5KHJvd0NvdW50ICsgMSk7XG4gICAgdGhpcy55UG9zaXRpb25zWzBdID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd0NvdW50OyBpKyspIHtcbiAgICAgIHRoaXMueVBvc2l0aW9uc1tpICsgMV0gPSB0aGlzLmdldFJvd0hlaWdodChpKSArIHRoaXMueVBvc2l0aW9uc1tpXTtcbiAgICB9XG4gIH1cblxufVxuXG5cbiJdfQ==