import { CellRange } from "../data/common/cell-range";
export class SelectionService {
    tableScope;
    getSelectionModel;
    getFocusModel;
    previousEvt;
    constructor(tableScope) {
        this.tableScope = tableScope;
        if (this.tableScope.tableOptions?.getSelectionModel) {
            this.getSelectionModel = this.tableScope.tableOptions.getSelectionModel;
        }
        if (this.tableScope.tableOptions?.getFocusModel) {
            this.getFocusModel = this.tableScope.tableOptions.getFocusModel;
        }
    }
    onMouseClicked(evt, _previousEvt) {
        let dirty = false;
        let deletePreviousEvent = false;
        if (this.getSelectionModel && this.getFocusModel) {
            const sm = this.getSelectionModel();
            const fm = this.getFocusModel();
            if (sm && fm) {
                // Focus:
                if (!fm.hasFocus(evt.rowIndex, evt.columnIndex)) {
                    fm.setFocus(evt.rowIndex, evt.columnIndex);
                    dirty = true;
                }
                // Selection:
                if (!evt.originalEvent?.shiftKey) {
                    if (sm.hasSelection()) {
                        sm.clear();
                        dirty = true;
                    }
                }
                if (evt.originalEvent?.shiftKey && this.previousEvt) {
                    sm.addSelection(this.createRangeByEvents(evt, this.previousEvt));
                    deletePreviousEvent = true;
                    dirty = true;
                }
                else if (evt.originalEvent?.ctrlKey || evt.originalEvent?.metaKey) {
                    sm.addSelection(CellRange.singleCell(evt.rowIndex, evt.columnIndex));
                    deletePreviousEvent = true;
                    dirty = true;
                }
                else if (evt.originalEvent?.altKey && (evt.originalEvent?.ctrlKey || evt.originalEvent?.metaKey)) {
                    sm.removeSelection(CellRange.singleCell(evt.rowIndex, evt.columnIndex));
                    deletePreviousEvent = true;
                    dirty = true;
                }
            }
        }
        if (deletePreviousEvent) {
            this.previousEvt = undefined;
        }
        else {
            this.previousEvt = evt?.clone();
        }
        return dirty;
    }
    onActionTriggered(actionId) {
        if (this.getSelectionModel && this.getFocusModel) {
            const sm = this.getSelectionModel();
            const fm = this.getFocusModel();
            if (sm && fm) {
                if (actionId === "SELECT_ALL") {
                    sm.selectAll();
                    this.tableScope.repaint();
                    return true;
                }
                if (actionId === "DESELECT_ALL") {
                    sm.clear();
                    this.tableScope.repaint();
                    return true;
                }
                if (actionId === "TOGGLE_SELECTION") {
                    const [row, col] = fm.getFocus();
                    sm.togglePoint(row, col);
                    this.tableScope.repaint();
                    return true;
                }
            }
        }
        return false;
    }
    createRangeByEvents(evt, previousEvt) {
        if (!previousEvt) {
            previousEvt = evt;
        }
        const r1 = Math.min(evt.rowIndex, previousEvt?.rowIndex);
        const r2 = Math.max(evt.rowIndex, previousEvt?.rowIndex);
        const c1 = Math.min(evt.columnIndex, previousEvt?.columnIndex);
        const c2 = Math.max(evt.columnIndex, previousEvt?.columnIndex);
        return CellRange.create({
            rowIndex1: r1,
            columnIndex1: c1,
            rowIndex2: r2,
            columnIndex2: c2
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0aW9uLXNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3RhYmxlL3NyYy9saWIvdGFibGUvc2VsZWN0aW9uL3NlbGVjdGlvbi1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUt0RCxNQUFNLE9BQU8sZ0JBQWdCO0lBUU47SUFOWCxpQkFBaUIsQ0FBMEI7SUFDM0MsYUFBYSxDQUFzQjtJQUNuQyxXQUFXLENBQWdCO0lBR3JDLFlBQ3FCLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFFekMsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxpQkFBaUIsRUFBRTtZQUNuRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUM7U0FDekU7UUFDRCxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLGFBQWEsRUFBRTtZQUMvQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQztTQUNqRTtJQUNILENBQUM7SUFHRCxjQUFjLENBQUMsR0FBaUIsRUFBRSxZQUFzQztRQUN0RSxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbEIsSUFBSSxtQkFBbUIsR0FBRyxLQUFLLENBQUM7UUFFaEMsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNoRCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNwQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDaEMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFO2dCQUVaLFNBQVM7Z0JBQ1QsSUFBSSxDQUFD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QUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztvQkFDekIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztvQkFDMUIsT0FBTyxJQUFJLENBQUM7aUJBQ2I7YUFDRjtTQUNGO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBR08sbUJBQW1CLENBQUMsR0FBaUIsRUFBRSxXQUEwQjtRQUN2RSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2hCLFdBQVcsR0FBRyxHQUFHLENBQUM7U0FDbkI7UUFDRCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDekQsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUMvRCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQy9ELE9BQU8sU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUN0QixTQUFTLEVBQUUsRUFBRTtZQUNiLFlBQVksRUFBRSxFQUFFO1lBQ2hCLFNBQVMsRUFBRSxFQUFFO1lBQ2IsWUFBWSxFQUFFLEVBQUU7U0FDakIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUVGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR2VNb3VzZUV2ZW50IH0gZnJvbSBcIi4uL2RhdGEvY29tbW9uL2V2ZW50L2dlLW1vdXNlLWV2ZW50XCI7XG5pbXBvcnQgeyBUYWJsZVNjb3BlIH0gZnJvbSBcIi4uL3RhYmxlLXNjb3BlXCI7XG5pbXBvcnQgeyBHZXRUIH0gZnJvbSBcIi4uL2RhdGEvY29tbW9uL2dldC10XCI7XG5pbXBvcnQgeyBTZWxlY3Rpb25Nb2RlbElmIH0gZnJvbSBcIi4vc2VsZWN0aW9uLW1vZGVsLmlmXCI7XG5pbXBvcnQgeyBGb2N1c01vZGVsSWYgfSBmcm9tIFwiLi4vZm9jdXMvZm9jdXMtbW9kZWwuaWZcIjtcbmltcG9ydCB7IENlbGxSYW5nZSB9IGZyb20gXCIuLi9kYXRhL2NvbW1vbi9jZWxsLXJhbmdlXCI7XG5pbXBvcnQgeyBPbkFjdGlvblRyaWdnZXJlZElmIH0gZnJvbSBcIi4uL2FjdGlvbi9vbi1hY3Rpb24tdHJpZ2dlcmVkLmlmXCI7XG5pbXBvcnQgeyBBY3Rpb25JZCB9IGZyb20gXCIuLi9hY3Rpb24vYWN0aW9uLWlkLnR5cGVcIjtcblxuXG5leHBvcnQgY2xhc3MgU2VsZWN0aW9uU2VydmljZSBpbXBsZW1lbnRzIE9uQWN0aW9uVHJpZ2dlcmVkSWYge1xuXG4gIHByb3RlY3RlZCBnZXRTZWxlY3Rpb25Nb2RlbD86IEdldFQ8U2VsZWN0aW9uTW9kZWxJZj47XG4gIHByb3RlY3RlZCBnZXRGb2N1c01vZGVsPzogR2V0VDxGb2N1c01vZGVsSWY+O1xuICBwcm90ZWN0ZWQgcHJldmlvdXNFdnQ/OiBHZU1vdXNlRXZlbnQ7XG5cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgdGFibGVTY29wZTogVGFibGVTY29wZVxuICApIHtcbiAgICBpZiAodGhpcy50YWJsZVNjb3BlLnRhYmxlT3B0aW9ucz8uZ2V0U2VsZWN0aW9uTW9kZWwpIHtcbiAgICAgIHRoaXMuZ2V0U2VsZWN0aW9uTW9kZWwgPSB0aGlzLnRhYmxlU2NvcGUudGFibGVPcHRpb25zLmdldFNlbGVjdGlvbk1vZGVsO1xuICAgIH1cbiAgICBpZiAodGhpcy50YWJsZVNjb3BlLnRhYmxlT3B0aW9ucz8uZ2V0Rm9jdXNNb2RlbCkge1xuICAgICAgdGhpcy5nZXRGb2N1c01vZGVsID0gdGhpcy50YWJsZVNjb3BlLnRhYmxlT3B0aW9ucy5nZXRGb2N1c01vZGVsO1xuICAgIH1cbiAgfVxuXG5cbiAgb25Nb3VzZUNsaWNrZWQoZXZ0OiBHZU1vdXNlRXZlbnQsIF9wcmV2aW91c0V2dDogR2VNb3VzZUV2ZW50IHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gICAgbGV0IGRpcnR5ID0gZmFsc2U7XG4gICAgbGV0IGRlbGV0ZVByZXZpb3VzRXZlbnQgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLmdldFNlbGVjdGlvbk1vZGVsICYmIHRoaXMuZ2V0Rm9jdXNNb2RlbCkge1xuICAgICAgY29uc3Qgc20gPSB0aGlzLmdldFNlbGVjdGlvbk1vZGVsKCk7XG4gICAgICBjb25zdCBmbSA9IHRoaXMuZ2V0Rm9jdXNNb2RlbCgpO1xuICAgICAgaWYgKHNtICYmIGZtKSB7XG5cbiAgICAgICAgLy8gRm9jdXM6XG4gICAgICAgIGlmICghZm0uaGFzRm9jdXMoZXZ0LnJvd0luZGV4LCBldnQuY29sdW1uSW5kZXgpKSB7XG4gICAgICAgICAgZm0uc2V0Rm9jdXMoZXZ0LnJvd0luZGV4LCBldnQuY29sdW1uSW5kZXgpO1xuICAgICAgICAgIGRpcnR5ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNlbGVjdGlvbjpcbiAgICAgICAgaWYgKCFldnQub3JpZ2luYWxFdmVudD8uc2hpZnRLZXkpIHtcbiAgICAgICAgICBpZiAoc20uaGFzU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgIHNtLmNsZWFyKCk7XG4gICAgICAgICAgICBkaXJ0eSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChldnQub3JpZ2luYWxFdmVudD8uc2hpZnRLZXkgJiYgdGhpcy5wcmV2aW91c0V2dCkge1xuICAgICAgICAgIHNtLmFkZFNlbGVjdGlvbih0aGlzLmNyZWF0ZVJhbmdlQnlFdmVudHMoZXZ0LCB0aGlzLnByZXZpb3VzRXZ0KSk7XG4gICAgICAgICAgZGVsZXRlUHJldmlvdXNFdmVudCA9IHRydWU7XG4gICAgICAgICAgZGlydHkgPSB0cnVlO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoZXZ0Lm9yaWdpbmFsRXZlbnQ/LmN0cmxLZXkgfHwgZXZ0Lm9yaWdpbmFsRXZlbnQ/Lm1ldGFLZXkpIHtcbiAgICAgICAgICBzbS5hZGRTZWxlY3Rpb24oQ2VsbFJhbmdlLnNpbmdsZUNlbGwoZXZ0LnJvd0luZGV4LCBldnQuY29sdW1uSW5kZXgpKTtcbiAgICAgICAgICBkZWxldGVQcmV2aW91c0V2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICBkaXJ0eSA9IHRydWU7XG5cbiAgICAgICAgfSBlbHNlIGlmIChldnQub3JpZ2luYWxFdmVudD8uYWx0S2V5ICYmIChldnQub3JpZ2luYWxFdmVudD8uY3RybEtleSB8fCBldnQub3JpZ2luYWxFdmVudD8ubWV0YUtleSkpIHtcbiAgICAgICAgICBzbS5yZW1vdmVTZWxlY3Rpb24oQ2VsbFJhbmdlLnNpbmdsZUNlbGwoZXZ0LnJvd0luZGV4LCBldnQuY29sdW1uSW5kZXgpKTtcbiAgICAgICAgICBkZWxldGVQcmV2aW91c0V2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICBkaXJ0eSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGRlbGV0ZVByZXZpb3VzRXZlbnQpIHtcbiAgICAgIHRoaXMucHJldmlvdXNFdnQgPSB1bmRlZmluZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJldmlvdXNFdnQgPSBldnQ/LmNsb25lKCk7XG4gICAgfVxuICAgIHJldHVybiBkaXJ0eTtcbiAgfVxuXG4gIG9uQWN0aW9uVHJpZ2dlcmVkKGFjdGlvbklkOiBBY3Rpb25JZCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmdldFNlbGVjdGlvbk1vZGVsICYmIHRoaXMuZ2V0Rm9jdXNNb2RlbCkge1xuICAgICAgY29uc3Qgc20gPSB0aGlzLmdldFNlbGVjdGlvbk1vZGVsKCk7XG4gICAgICBjb25zdCBmbSA9IHRoaXMuZ2V0Rm9jdXNNb2RlbCgpO1xuICAgICAgaWYgKHNtICYmIGZtKSB7XG4gICAgICAgIGlmIChhY3Rpb25JZCA9PT0gXCJTRUxFQ1RfQUxMXCIpIHtcbiAgICAgICAgICBzbS5zZWxlY3RBbGwoKTtcbiAgICAgICAgICB0aGlzLnRhYmxlU2NvcGUucmVwYWludCgpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY3Rpb25JZCA9PT0gXCJERVNFTEVDVF9BTExcIikge1xuICAgICAgICAgIHNtLmNsZWFyKCk7XG4gICAgICAgICAgdGhpcy50YWJsZVNjb3BlLnJlcGFpbnQoKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0aW9uSWQgPT09IFwiVE9HR0xFX1NFTEVDVElPTlwiKSB7XG4gICAgICAgICAgY29uc3QgW3JvdywgY29sXSA9IGZtLmdldEZvY3VzKCk7XG4gICAgICAgICAgc20udG9nZ2xlUG9pbnQocm93LCBjb2wpO1xuICAgICAgICAgIHRoaXMudGFibGVTY29wZS5yZXBhaW50KCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cblxuICBwcml2YXRlIGNyZWF0ZVJhbmdlQnlFdmVudHMoZXZ0OiBHZU1vdXNlRXZlbnQsIHByZXZpb3VzRXZ0PzogR2VNb3VzZUV2ZW50KSB7XG4gICAgaWYgKCFwcmV2aW91c0V2dCkge1xuICAgICAgcHJldmlvdXNFdnQgPSBldnQ7XG4gICAgfVxuICAgIGNvbnN0IHIxID0gTWF0aC5taW4oZXZ0LnJvd0luZGV4LCBwcmV2aW91c0V2dD8ucm93SW5kZXgpO1xuICAgIGNvbnN0IHIyID0gTWF0aC5tYXgoZXZ0LnJvd0luZGV4LCBwcmV2aW91c0V2dD8ucm93SW5kZXgpO1xuICAgIGNvbnN0IGMxID0gTWF0aC5taW4oZXZ0LmNvbHVtbkluZGV4LCBwcmV2aW91c0V2dD8uY29sdW1uSW5kZXgpO1xuICAgIGNvbnN0IGMyID0gTWF0aC5tYXgoZXZ0LmNvbHVtbkluZGV4LCBwcmV2aW91c0V2dD8uY29sdW1uSW5kZXgpO1xuICAgIHJldHVybiBDZWxsUmFuZ2UuY3JlYXRlKHtcbiAgICAgIHJvd0luZGV4MTogcjEsXG4gICAgICBjb2x1bW5JbmRleDE6IGMxLFxuICAgICAgcm93SW5kZXgyOiByMixcbiAgICAgIGNvbHVtbkluZGV4MjogYzJcbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=